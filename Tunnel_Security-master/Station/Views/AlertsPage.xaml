<Page
    x:Class="Station.Views.AlertsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:Station.ViewModels"
    xmlns:lvc="using:LiveChartsCore.SkiaSharpView.WinUI"
    Background="{StaticResource BackgroundSecondaryBrush}">

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="380"/>
        </Grid.ColumnDefinitions>

        <!-- Main Content -->
        <Grid Grid.Column="0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Header & Statistics Cards -->
            <Grid Grid.Row="0" Padding="24,20,24,16">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Header -->
                <StackPanel Grid.Row="0" Orientation="Horizontal" Spacing="16" Margin="0,0,0,16">
                    <TextBlock Text="ðŸš¨ Trung tÃ¢m Cáº£nh bÃ¡o" 
                               FontSize="22" FontWeight="Bold" 
                               Foreground="{StaticResource TextPrimaryBrush}"/>
                    <Border Background="{StaticResource SeverityCriticalBrush}" 
                            CornerRadius="12" Padding="10,4" VerticalAlignment="Center">
                        <TextBlock Text="{x:Bind ViewModel.UnprocessedCount, Mode=OneWay}" 
                                   FontSize="13" FontWeight="Bold" Foreground="White"/>
                    </Border>
                    <TextBlock Text="cáº£nh bÃ¡o chÆ°a xá»­ lÃ½" FontSize="13" 
                               Foreground="{StaticResource TextSecondaryBrush}" 
                               VerticalAlignment="Center"/>
                </StackPanel>

                <!-- Statistics Cards -->
                <Grid Grid.Row="1">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Critical -->
                    <Border Grid.Column="0" Background="#FEE2E2" CornerRadius="12" Padding="16" Margin="0,0,8,0">
                        <StackPanel>
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <FontIcon Glyph="&#xEB90;" FontSize="18" Foreground="#DC2626"/>
                                <TextBlock Text="NghiÃªm trá»ng" FontSize="12" Foreground="#991B1B"/>
                            </StackPanel>
                            <TextBlock Text="{x:Bind ViewModel.CriticalCount, Mode=OneWay}" 
                                       FontSize="28" FontWeight="Bold" Foreground="#DC2626" Margin="0,8,0,0"/>
                        </StackPanel>
                    </Border>

                    <!-- High -->
                    <Border Grid.Column="1" Background="#FFEDD5" CornerRadius="12" Padding="16" Margin="4,0">
                        <StackPanel>
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <FontIcon Glyph="&#xE783;" FontSize="18" Foreground="#EA580C"/>
                                <TextBlock Text="Cao" FontSize="12" Foreground="#9A3412"/>
                            </StackPanel>
                            <TextBlock Text="{x:Bind ViewModel.HighCount, Mode=OneWay}" 
                                       FontSize="28" FontWeight="Bold" Foreground="#EA580C" Margin="0,8,0,0"/>
                        </StackPanel>
                    </Border>

                    <!-- Medium -->
                    <Border Grid.Column="2" Background="#FEF9C3" CornerRadius="12" Padding="16" Margin="4,0">
                        <StackPanel>
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <FontIcon Glyph="&#xE7BA;" FontSize="18" Foreground="#CA8A04"/>
                                <TextBlock Text="Trung bÃ¬nh" FontSize="12" Foreground="#854D0E"/>
                            </StackPanel>
                            <TextBlock Text="{x:Bind ViewModel.MediumCount, Mode=OneWay}" 
                                       FontSize="28" FontWeight="Bold" Foreground="#CA8A04" Margin="0,8,0,0"/>
                        </StackPanel>
                    </Border>

                    <!-- Low -->
                    <Border Grid.Column="3" Background="#DCFCE7" CornerRadius="12" Padding="16" Margin="4,0">
                        <StackPanel>
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <FontIcon Glyph="&#xE946;" FontSize="18" Foreground="#16A34A"/>
                                <TextBlock Text="Tháº¥p" FontSize="12" Foreground="#166534"/>
                            </StackPanel>
                            <TextBlock Text="{x:Bind ViewModel.LowCount, Mode=OneWay}" 
                                       FontSize="28" FontWeight="Bold" Foreground="#16A34A" Margin="0,8,0,0"/>
                        </StackPanel>
                    </Border>

                    <!-- Today/Week/Month Summary -->
                    <Border Grid.Column="4" Background="{StaticResource BackgroundPrimaryBrush}" 
                            CornerRadius="12" Padding="16" Margin="8,0,0,0"
                            BorderBrush="{StaticResource BorderLightBrush}" BorderThickness="1">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            <TextBlock Text="Thá»‘ng kÃª" FontSize="12" Foreground="{StaticResource TextSecondaryBrush}"/>
                            <StackPanel Grid.Row="1" Margin="0,8,0,0">
                                <StackPanel Orientation="Horizontal" Spacing="4">
                                    <TextBlock Text="{x:Bind ViewModel.TodayCount, Mode=OneWay}" FontWeight="Bold" Foreground="{StaticResource TextPrimaryBrush}"/>
                                    <TextBlock Text="hÃ´m nay" FontSize="11" Foreground="{StaticResource TextTertiaryBrush}"/>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal" Spacing="4">
                                    <TextBlock Text="{x:Bind ViewModel.WeekCount, Mode=OneWay}" FontWeight="Bold" Foreground="{StaticResource TextPrimaryBrush}"/>
                                    <TextBlock Text="tuáº§n nÃ y" FontSize="11" Foreground="{StaticResource TextTertiaryBrush}"/>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal" Spacing="4">
                                    <TextBlock Text="{x:Bind ViewModel.MonthCount, Mode=OneWay}" FontWeight="Bold" Foreground="{StaticResource TextPrimaryBrush}"/>
                                    <TextBlock Text="thÃ¡ng nÃ y" FontSize="11" Foreground="{StaticResource TextTertiaryBrush}"/>
                                </StackPanel>
                            </StackPanel>
                        </Grid>
                    </Border>
                </Grid>
            </Grid>

            <!-- Filters Bar -->
            <Border Grid.Row="1" Background="{StaticResource BackgroundPrimaryBrush}" 
                    Margin="24,0" Padding="16" CornerRadius="12"
                    BorderBrush="{StaticResource BorderLightBrush}" BorderThickness="1">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- Filter Dropdowns -->
                    <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="10">
                        <!-- Period Filter -->
                        <ComboBox ItemsSource="{x:Bind ViewModel.Periods}" 
                                  SelectedItem="{x:Bind ViewModel.SelectedPeriod, Mode=TwoWay}"
                                  MinWidth="120" Style="{StaticResource ComboBoxStyle}"/>

                        <!-- Line Filter -->
                        <ComboBox ItemsSource="{x:Bind ViewModel.Lines}" 
                                  SelectedItem="{x:Bind ViewModel.SelectedLine, Mode=TwoWay}"
                                  MinWidth="160" Style="{StaticResource ComboBoxStyle}"/>

                        <!-- Severity Filter -->
                        <ComboBox ItemsSource="{x:Bind ViewModel.Severities}" 
                                  SelectedItem="{x:Bind ViewModel.SelectedSeverity, Mode=TwoWay}"
                                  MinWidth="140" Style="{StaticResource ComboBoxStyle}"/>

                        <!-- Status Filter -->
                        <ComboBox ItemsSource="{x:Bind ViewModel.Statuses}" 
                                  SelectedItem="{x:Bind ViewModel.SelectedStatus, Mode=TwoWay}"
                                  MinWidth="140" Style="{StaticResource ComboBoxStyle}"/>

                        <!-- Category Filter -->
                        <ComboBox ItemsSource="{x:Bind ViewModel.Categories}" 
                                  SelectedItem="{x:Bind ViewModel.SelectedCategory, Mode=TwoWay}"
                                  MinWidth="130" Style="{StaticResource ComboBoxStyle}"/>
                    </StackPanel>

                    <!-- Search & Actions -->
                    <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="10">
                        <TextBox PlaceholderText="TÃ¬m kiáº¿m..." 
                                 Text="{x:Bind ViewModel.SearchQuery, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                 MinWidth="200" Style="{StaticResource SearchTextBoxStyle}"/>
                        
                        <Button Style="{StaticResource SecondaryButtonStyle}" 
                                Command="{x:Bind ViewModel.ClearFiltersCommand}"
                                ToolTipService.ToolTip="XÃ³a bá»™ lá»c">
                            <FontIcon Glyph="&#xE711;" FontSize="14"/>
                        </Button>
                        
                        <Button Style="{StaticResource PrimaryButtonStyle}" 
                                Command="{x:Bind ViewModel.RefreshAlertsCommand}"
                                ToolTipService.ToolTip="LÃ m má»›i">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <FontIcon Glyph="&#xE72C;" FontSize="14"/>
                                <TextBlock Text="LÃ m má»›i"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Alerts List -->
            <Border Grid.Row="2" Margin="24,16,24,24" 
                    Background="{StaticResource BackgroundPrimaryBrush}" 
                    CornerRadius="12" 
                    BorderBrush="{StaticResource BorderLightBrush}" BorderThickness="1">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- List Header -->
                    <Border Grid.Row="0" Padding="20,12" 
                            BorderBrush="{StaticResource BorderLightBrush}" BorderThickness="0,0,0,1">
                        <Grid>
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <TextBlock Text="Danh sÃ¡ch cáº£nh bÃ¡o" FontSize="14" FontWeight="SemiBold" 
                                           Foreground="{StaticResource TextPrimaryBrush}"/>
                                <Border Background="{StaticResource BackgroundTertiaryBrush}" 
                                        CornerRadius="10" Padding="8,2">
                                    <TextBlock FontSize="12" Foreground="{StaticResource TextSecondaryBrush}">
                                        <Run Text="{x:Bind ViewModel.FilteredCount, Mode=OneWay}"/>
                                        <Run Text="/"/>
                                        <Run Text="{x:Bind ViewModel.TotalAlerts, Mode=OneWay}"/>
                                    </TextBlock>
                                </Border>
                            </StackPanel>
                        </Grid>
                    </Border>

                    <!-- Scrollable Alerts -->
                    <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Padding="12">
                        <ItemsRepeater ItemsSource="{x:Bind ViewModel.FilteredAlerts, Mode=OneWay}">
                            <ItemsRepeater.ItemTemplate>
                                <DataTemplate x:DataType="local:AlertItemViewModel">
                                    <Border Background="{StaticResource BackgroundPrimaryBrush}"
                                            CornerRadius="10" Padding="16" Margin="0,0,0,8"
                                            BorderBrush="{StaticResource BorderLightBrush}" BorderThickness="1"
                                            PointerPressed="AlertItem_PointerPressed">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="4"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>

                                            <!-- Severity Indicator Bar -->
                                            <Border Grid.Column="0" Background="{Binding SeverityColor}" 
                                                    CornerRadius="2" Margin="0,0,12,0"/>

                                            <!-- Alert Content -->
                                            <StackPanel Grid.Column="1" Spacing="6">
                                                <!-- Title & Badges -->
                                                <StackPanel Orientation="Horizontal" Spacing="8">
                                                    <TextBlock Text="{Binding Title}" FontSize="14" FontWeight="SemiBold" 
                                                               Foreground="{StaticResource TextPrimaryBrush}"
                                                               TextTrimming="CharacterEllipsis" MaxWidth="400"/>
                                                    
                                                    <!-- Severity Badge -->
                                                    <Border Background="{Binding SeverityBgColor}" CornerRadius="4" Padding="6,2">
                                                        <StackPanel Orientation="Horizontal" Spacing="4">
                                                            <FontIcon Glyph="{Binding SeverityIcon}" FontSize="10" 
                                                                      Foreground="{Binding SeverityTextColor}"/>
                                                            <TextBlock Text="{Binding SeverityText}" FontSize="10" 
                                                                       FontWeight="SemiBold" Foreground="{Binding SeverityTextColor}"/>
                                                        </StackPanel>
                                                    </Border>

                                                    <!-- Category Badge -->
                                                    <Border Background="{StaticResource BackgroundTertiaryBrush}" 
                                                            CornerRadius="4" Padding="6,2">
                                                        <TextBlock Text="{Binding CategoryText}" FontSize="10" 
                                                                   Foreground="{StaticResource TextSecondaryBrush}"/>
                                                    </Border>
                                                </StackPanel>

                                                <!-- Location & Time -->
                                                <StackPanel Orientation="Horizontal" Spacing="12">
                                                    <StackPanel Orientation="Horizontal" Spacing="4">
                                                        <FontIcon Glyph="&#xE81D;" FontSize="12" 
                                                                  Foreground="{StaticResource TextTertiaryBrush}"/>
                                                        <TextBlock Text="{Binding LocationText}" FontSize="12" 
                                                                   Foreground="{StaticResource TextSecondaryBrush}"/>
                                                    </StackPanel>
                                                    <StackPanel Orientation="Horizontal" Spacing="4">
                                                        <FontIcon Glyph="&#xE787;" FontSize="12" 
                                                                  Foreground="{StaticResource TextTertiaryBrush}"/>
                                                        <TextBlock Text="{Binding TimeAgo}" FontSize="12" 
                                                                   Foreground="{StaticResource TextTertiaryBrush}"/>
                                                    </StackPanel>
                                                    
                                                    <!-- Sensor Value if exists -->
                                                    <StackPanel Orientation="Horizontal" Spacing="4" 
                                                                Visibility="{Binding HasSensor, Converter={StaticResource BoolToVisibilityConverter}}">
                                                        <FontIcon Glyph="&#xE9D9;" FontSize="12" 
                                                                  Foreground="{StaticResource TextTertiaryBrush}"/>
                                                        <TextBlock Text="{Binding SensorValueText}" FontSize="12" 
                                                                   Foreground="{Binding SeverityColor}" FontWeight="SemiBold"/>
                                                    </StackPanel>

                                                    <!-- Camera indicator -->
                                                    <FontIcon Glyph="&#xE714;" FontSize="12" 
                                                              Foreground="{StaticResource AccentBrush}"
                                                              Visibility="{Binding HasCamera, Converter={StaticResource BoolToVisibilityConverter}}"
                                                              ToolTipService.ToolTip="CÃ³ camera"/>
                                                </StackPanel>
                                            </StackPanel>

                                            <!-- Status & Actions -->
                                            <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="8" 
                                                        VerticalAlignment="Center">
                                                <!-- Status Badge -->
                                                <Border Background="{Binding StateBgColor}" CornerRadius="6" Padding="10,5">
                                                    <StackPanel Orientation="Horizontal" Spacing="4">
                                                        <FontIcon Glyph="{Binding StateIcon}" FontSize="12" 
                                                                  Foreground="{Binding StateColor}"/>
                                                        <TextBlock Text="{Binding StateText}" FontSize="11" 
                                                                   FontWeight="SemiBold" Foreground="{Binding StateColor}"/>
                                                    </StackPanel>
                                                </Border>

                                                <!-- Quick Actions -->
                                                <Button Style="{StaticResource IconButtonStyle}" 
                                                        ToolTipService.ToolTip="Chi tiáº¿t"
                                                        Click="ViewDetailButton_Click" Tag="{Binding}">
                                                    <FontIcon Glyph="&#xE76C;" FontSize="14"/>
                                                </Button>
                                            </StackPanel>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsRepeater.ItemTemplate>
                        </ItemsRepeater>
                    </ScrollViewer>
                </Grid>
            </Border>
        </Grid>

        <!-- Detail Panel (Right Sidebar) -->
        <Border Grid.Column="1" Background="{StaticResource BackgroundPrimaryBrush}"
                BorderBrush="{StaticResource BorderLightBrush}" BorderThickness="1,0,0,0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Panel Header -->
                <Border Grid.Row="0" Padding="20,16" 
                        BorderBrush="{StaticResource BorderLightBrush}" BorderThickness="0,0,0,1">
                    <StackPanel Orientation="Horizontal" Spacing="10">
                        <FontIcon Glyph="&#xE946;" FontSize="18" Foreground="{StaticResource AccentBrush}"/>
                        <TextBlock Text="Chi tiáº¿t cáº£nh bÃ¡o" FontSize="16" FontWeight="SemiBold" 
                                   Foreground="{StaticResource TextPrimaryBrush}"/>
                    </StackPanel>
                </Border>

                <!-- Detail Content -->
                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                    <StackPanel Padding="20" Spacing="16" 
                                Visibility="{x:Bind ViewModel.SelectedAlert, Mode=OneWay, Converter={StaticResource NullToVisibilityConverter}}">
                        
                        <!-- Alert Header -->
                        <StackPanel Spacing="8">
                            <TextBlock Text="{x:Bind ViewModel.SelectedAlert.Title, Mode=OneWay}" 
                                       FontSize="16" FontWeight="Bold" 
                                       Foreground="{StaticResource TextPrimaryBrush}" TextWrapping="Wrap"/>
                            
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <Border Background="{x:Bind ViewModel.SelectedAlert.SeverityBgColor, Mode=OneWay}" 
                                        CornerRadius="4" Padding="8,4">
                                    <TextBlock Text="{x:Bind ViewModel.SelectedAlert.SeverityText, Mode=OneWay}" 
                                               FontSize="11" FontWeight="Bold" 
                                               Foreground="{x:Bind ViewModel.SelectedAlert.SeverityTextColor, Mode=OneWay}"/>
                                </Border>
                                <Border Background="{x:Bind ViewModel.SelectedAlert.StateBgColor, Mode=OneWay}" 
                                        CornerRadius="4" Padding="8,4">
                                    <TextBlock Text="{x:Bind ViewModel.SelectedAlert.StateText, Mode=OneWay}" 
                                               FontSize="11" FontWeight="Bold" 
                                               Foreground="{x:Bind ViewModel.SelectedAlert.StateColor, Mode=OneWay}"/>
                                </Border>
                            </StackPanel>
                        </StackPanel>

                        <!-- Description -->
                        <Border Background="{StaticResource BackgroundSecondaryBrush}" 
                                CornerRadius="8" Padding="12">
                            <TextBlock Text="{x:Bind ViewModel.SelectedAlert.Description, Mode=OneWay}" 
                                       FontSize="13" Foreground="{StaticResource TextSecondaryBrush}" 
                                       TextWrapping="Wrap"/>
                        </Border>

                        <!-- Location Info -->
                        <StackPanel Spacing="8">
                            <TextBlock Text="ðŸ“ Vá»‹ trÃ­" FontSize="13" FontWeight="SemiBold" 
                                       Foreground="{StaticResource TextPrimaryBrush}"/>
                            <Border Background="{StaticResource BackgroundSecondaryBrush}" 
                                    CornerRadius="8" Padding="12">
                                <StackPanel Spacing="6">
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <TextBlock Text="Tuyáº¿n:" FontSize="12" Foreground="{StaticResource TextTertiaryBrush}" Width="60"/>
                                        <TextBlock Text="{x:Bind ViewModel.SelectedAlert.LineName, Mode=OneWay}" 
                                                   FontSize="12" Foreground="{StaticResource TextPrimaryBrush}" FontWeight="SemiBold"/>
                                    </StackPanel>
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <TextBlock Text="NÃºt:" FontSize="12" Foreground="{StaticResource TextTertiaryBrush}" Width="60"/>
                                        <TextBlock Text="{x:Bind ViewModel.SelectedAlert.NodeName, Mode=OneWay}" 
                                                   FontSize="12" Foreground="{StaticResource TextPrimaryBrush}" FontWeight="SemiBold"/>
                                    </StackPanel>
                                </StackPanel>
                            </Border>
                        </StackPanel>

                        <!-- Sensor Info (if exists) -->
                        <StackPanel Spacing="8" x:Name="SensorInfoPanel">
                            <TextBlock Text="ðŸ“Š Dá»¯ liá»‡u cáº£m biáº¿n" FontSize="13" FontWeight="SemiBold" 
                                       Foreground="{StaticResource TextPrimaryBrush}"/>
                            <Border Background="{StaticResource BackgroundSecondaryBrush}" 
                                    CornerRadius="8" Padding="12">
                                <StackPanel Spacing="6">
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <TextBlock Text="Loáº¡i:" FontSize="12" Foreground="{StaticResource TextTertiaryBrush}" Width="60"/>
                                        <TextBlock Text="{x:Bind ViewModel.SelectedAlert.SensorType, Mode=OneWay}" 
                                                   FontSize="12" Foreground="{StaticResource TextPrimaryBrush}"/>
                                    </StackPanel>
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <TextBlock Text="GiÃ¡ trá»‹:" FontSize="12" Foreground="{StaticResource TextTertiaryBrush}" Width="60"/>
                                        <TextBlock FontSize="12" Foreground="{x:Bind ViewModel.SelectedAlert.SeverityColor, Mode=OneWay}" 
                                                   FontWeight="Bold">
                                            <Run Text="{x:Bind ViewModel.SelectedAlert.SensorValue, Mode=OneWay}"/>
                                            <Run Text=" "/>
                                            <Run Text="{x:Bind ViewModel.SelectedAlert.SensorUnit, Mode=OneWay}"/>
                                        </TextBlock>
                                    </StackPanel>
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <TextBlock Text="NgÆ°á»¡ng:" FontSize="12" Foreground="{StaticResource TextTertiaryBrush}" Width="60"/>
                                        <TextBlock FontSize="12" Foreground="{StaticResource TextSecondaryBrush}">
                                            <Run Text="{x:Bind ViewModel.SelectedAlert.Threshold, Mode=OneWay}"/>
                                            <Run Text=" "/>
                                            <Run Text="{x:Bind ViewModel.SelectedAlert.SensorUnit, Mode=OneWay}"/>
                                        </TextBlock>
                                    </StackPanel>
                                </StackPanel>
                            </Border>
                        </StackPanel>

                        <!-- Timeline -->
                        <StackPanel Spacing="8">
                            <TextBlock Text="â±ï¸ Lá»‹ch sá»­ xá»­ lÃ½" FontSize="13" FontWeight="SemiBold" 
                                       Foreground="{StaticResource TextPrimaryBrush}"/>
                            <Border Background="{StaticResource BackgroundSecondaryBrush}" 
                                    CornerRadius="8" Padding="12">
                                <StackPanel Spacing="8">
                                    <!-- Created -->
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <Border Background="#FEE2E2" CornerRadius="10" Width="20" Height="20">
                                            <FontIcon Glyph="&#xE7BA;" FontSize="10" Foreground="#DC2626" 
                                                      HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                        </Border>
                                        <StackPanel>
                                            <TextBlock Text="PhÃ¡t sinh cáº£nh bÃ¡o" FontSize="11" Foreground="{StaticResource TextPrimaryBrush}"/>
                                            <TextBlock Text="{x:Bind ViewModel.SelectedAlert.CreatedAt, Mode=OneWay}" 
                                                       FontSize="10" Foreground="{StaticResource TextTertiaryBrush}"/>
                                        </StackPanel>
                                    </StackPanel>

                                    <!-- Acknowledged -->
                                    <StackPanel Orientation="Horizontal" Spacing="8" 
                                                Visibility="{x:Bind ViewModel.SelectedAlert.AcknowledgedAt, Mode=OneWay, Converter={StaticResource NullToVisibilityConverter}}">
                                        <Border Background="#DBEAFE" CornerRadius="10" Width="20" Height="20">
                                            <FontIcon Glyph="&#xE73E;" FontSize="10" Foreground="#2563EB" 
                                                      HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                        </Border>
                                        <StackPanel>
                                            <TextBlock FontSize="11" Foreground="{StaticResource TextPrimaryBrush}">
                                                <Run Text="XÃ¡c nháº­n bá»Ÿi"/>
                                                <Run Text="{x:Bind ViewModel.SelectedAlert.AcknowledgedBy, Mode=OneWay}" FontWeight="SemiBold"/>
                                            </TextBlock>
                                            <TextBlock Text="{x:Bind ViewModel.SelectedAlert.AcknowledgedAt, Mode=OneWay}" 
                                                       FontSize="10" Foreground="{StaticResource TextTertiaryBrush}"/>
                                        </StackPanel>
                                    </StackPanel>

                                    <!-- Resolved -->
                                    <StackPanel Orientation="Horizontal" Spacing="8" 
                                                Visibility="{x:Bind ViewModel.SelectedAlert.ResolvedAt, Mode=OneWay, Converter={StaticResource NullToVisibilityConverter}}">
                                        <Border Background="#DCFCE7" CornerRadius="10" Width="20" Height="20">
                                            <FontIcon Glyph="&#xE930;" FontSize="10" Foreground="#16A34A" 
                                                      HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                        </Border>
                                        <StackPanel>
                                            <TextBlock FontSize="11" Foreground="{StaticResource TextPrimaryBrush}">
                                                <Run Text="Giáº£i quyáº¿t bá»Ÿi"/>
                                                <Run Text="{x:Bind ViewModel.SelectedAlert.ResolvedBy, Mode=OneWay}" FontWeight="SemiBold"/>
                                            </TextBlock>
                                            <TextBlock Text="{x:Bind ViewModel.SelectedAlert.ResolvedAt, Mode=OneWay}" 
                                                       FontSize="10" Foreground="{StaticResource TextTertiaryBrush}"/>
                                        </StackPanel>
                                    </StackPanel>
                                </StackPanel>
                            </Border>
                        </StackPanel>

                        <!-- Action Buttons -->
                        <StackPanel Spacing="8">
                            <TextBlock Text="ðŸ› ï¸ Thao tÃ¡c" FontSize="13" FontWeight="SemiBold" 
                                       Foreground="{StaticResource TextPrimaryBrush}"/>
                            
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <!-- Acknowledge Button -->
                                <Button Grid.Column="0" Grid.Row="0" Margin="0,0,4,8"
                                        Style="{StaticResource SecondaryButtonStyle}" 
                                        HorizontalAlignment="Stretch"
                                        IsEnabled="{x:Bind ViewModel.SelectedAlert.CanAcknowledge, Mode=OneWay}"
                                        Click="AcknowledgeButton_Click">
                                    <StackPanel Orientation="Horizontal" Spacing="6">
                                        <FontIcon Glyph="&#xE73E;" FontSize="12"/>
                                        <TextBlock Text="XÃ¡c nháº­n"/>
                                    </StackPanel>
                                </Button>

                                <!-- Process Button -->
                                <Button Grid.Column="1" Grid.Row="0" Margin="4,0,0,8"
                                        Style="{StaticResource SecondaryButtonStyle}" 
                                        HorizontalAlignment="Stretch"
                                        IsEnabled="{x:Bind ViewModel.SelectedAlert.CanProcess, Mode=OneWay}"
                                        Click="ProcessButton_Click">
                                    <StackPanel Orientation="Horizontal" Spacing="6">
                                        <FontIcon Glyph="&#xE768;" FontSize="12"/>
                                        <TextBlock Text="Xá»­ lÃ½"/>
                                    </StackPanel>
                                </Button>

                                <!-- Resolve Button -->
                                <Button Grid.Column="0" Grid.Row="1" Margin="0,0,4,0"
                                        Style="{StaticResource SuccessButtonStyle}" 
                                        HorizontalAlignment="Stretch"
                                        IsEnabled="{x:Bind ViewModel.SelectedAlert.CanResolve, Mode=OneWay}"
                                        Click="ResolveButton_Click">
                                    <StackPanel Orientation="Horizontal" Spacing="6">
                                        <FontIcon Glyph="&#xE930;" FontSize="12"/>
                                        <TextBlock Text="Giáº£i quyáº¿t"/>
                                    </StackPanel>
                                </Button>

                                <!-- Close Button -->
                                <Button Grid.Column="1" Grid.Row="1" Margin="4,0,0,0"
                                        Style="{StaticResource SecondaryButtonStyle}" 
                                        HorizontalAlignment="Stretch"
                                        IsEnabled="{x:Bind ViewModel.SelectedAlert.CanClose, Mode=OneWay}"
                                        Click="CloseAlertButton_Click">
                                    <StackPanel Orientation="Horizontal" Spacing="6">
                                        <FontIcon Glyph="&#xE8BB;" FontSize="12"/>
                                        <TextBlock Text="ÄÃ³ng"/>
                                    </StackPanel>
                                </Button>
                            </Grid>
                        </StackPanel>

                        <!-- Add Note Section -->
                        <StackPanel Spacing="8">
                            <TextBlock Text="ðŸ“ ThÃªm ghi chÃº" FontSize="13" FontWeight="SemiBold" 
                                       Foreground="{StaticResource TextPrimaryBrush}"/>
                            <TextBox x:Name="NoteTextBox" PlaceholderText="Nháº­p ghi chÃº..." 
                                     AcceptsReturn="True" TextWrapping="Wrap" MinHeight="60"
                                     Style="{StaticResource DefaultTextBoxStyle}"/>
                            <Button Style="{StaticResource PrimaryButtonStyle}" 
                                    HorizontalAlignment="Right" Click="AddNoteButton_Click">
                                <StackPanel Orientation="Horizontal" Spacing="6">
                                    <FontIcon Glyph="&#xE710;" FontSize="12"/>
                                    <TextBlock Text="ThÃªm ghi chÃº"/>
                                </StackPanel>
                            </Button>
                        </StackPanel>

                        <!-- Camera & Map Buttons -->
                        <StackPanel Spacing="8">
                            <Button Style="{StaticResource AccentButtonStyle}" 
                                    HorizontalAlignment="Stretch"
                                    Visibility="{x:Bind ViewModel.SelectedAlert.HasCamera, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"
                                    Click="ViewCameraButton_Click">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <FontIcon Glyph="&#xE714;" FontSize="14"/>
                                    <TextBlock Text="Xem Camera"/>
                                </StackPanel>
                            </Button>

                            <Button Style="{StaticResource SecondaryButtonStyle}" 
                                    HorizontalAlignment="Stretch"
                                    Click="ViewOnMapButton_Click">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <FontIcon Glyph="&#xE81D;" FontSize="14"/>
                                    <TextBlock Text="Xem trÃªn báº£n Ä‘á»“"/>
                                </StackPanel>
                            </Button>
                        </StackPanel>

                    </StackPanel>
                </ScrollViewer>

                <!-- Empty State when no alert selected -->
                <StackPanel Grid.Row="1" VerticalAlignment="Center" HorizontalAlignment="Center" Spacing="12"
                            Visibility="{x:Bind ViewModel.SelectedAlert, Mode=OneWay, Converter={StaticResource NullToInverseVisibilityConverter}}">
                    <FontIcon Glyph="&#xE7BA;" FontSize="48" Foreground="{StaticResource TextTertiaryBrush}"/>
                    <TextBlock Text="Chá»n má»™t cáº£nh bÃ¡o Ä‘á»ƒ xem chi tiáº¿t" 
                               FontSize="13" Foreground="{StaticResource TextTertiaryBrush}"
                               TextAlignment="Center"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Page>
