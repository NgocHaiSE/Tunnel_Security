<Page
    x:Class="Station.Views.UserManagementPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:vm="using:Station.ViewModels"
    Background="{StaticResource BackgroundSecondaryBrush}">

    <Page.DataContext>
        <vm:UserManagementViewModel />
    </Page.DataContext>

    <Page.Resources>

        <!-- Chip / badge dùng cho System / Custom -->
        <Style x:Key="ChipBadgeBorderStyle" TargetType="Border">
            <Setter Property="CornerRadius" Value="10" />
            <Setter Property="Padding" Value="10,3" />
            <Setter Property="MinHeight" Value="22" />
            <Setter Property="VerticalAlignment" Value="Center" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="BorderBrush" Value="#33000000" />
        </Style>

        <Style x:Key="ChipBadgeTextStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="11" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Foreground" Value="White" />
            <Setter Property="VerticalAlignment" Value="Center" />
        </Style>

        <!-- Tinh chỉnh ListViewItem cho roles (nền chọn + bo góc) -->
        <SolidColorBrush x:Key="ListViewItemBackground"
                         Color="Transparent" />
        <SolidColorBrush x:Key="ListViewItemBackgroundPointerOver"
                         Color="Transparent" />
        <SolidColorBrush x:Key="ListViewItemBackgroundPressed"
                         Color="Transparent" />
        <SolidColorBrush x:Key="ListViewItemBackgroundSelected"
                         Color="#1A3B82F6" />
        <!-- nền chọn nhạt -->
        <SolidColorBrush x:Key="ListViewItemBackgroundSelectedPointerOver"
                         Color="#263B82F6" />
        <SolidColorBrush x:Key="ListViewItemBorderBrushSelected"
                         Color="#3B82F6" />
        <CornerRadius x:Key="ListViewItemCornerRadius">14</CornerRadius>
        <Thickness x:Key="ListViewItemBorderThickness">1</Thickness>
        <Thickness x:Key="ListViewItemPadding">0</Thickness>

    </Page.Resources>

    <ScrollViewer Background="{StaticResource BackgroundSecondaryBrush}">
        <StackPanel Padding="32,24" Spacing="20">

            <!-- HEADER -->
            <StackPanel Spacing="4">
                <TextBlock Text="Admin Panel"
                           FontSize="26"
                           FontWeight="SemiBold"
                           Foreground="{StaticResource TextPrimaryBrush}" />
                <TextBlock Text="Quản lý người dùng, vai trò và quyền truy cập"
                           Foreground="{StaticResource TextSecondaryBrush}" />
            </StackPanel>

            <!-- SEGMENTED TABS -->
            <Border Margin="0,24,0,8"
                    Background="{StaticResource BackgroundPrimaryBrush}"
                    BorderBrush="{StaticResource BorderLightBrush}"
                    BorderThickness="1"
                    CornerRadius="24"
                    Padding="3">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <!-- TAB 1: Users & Contractors -->
                    <Button x:Name="UsersTabButton"
                            Grid.Column="0"
                            Content="Users &amp; Contractors"
                            FontSize="13"
                            FontWeight="SemiBold"
                            HorizontalAlignment="Stretch"
                            Padding="0,6"
                            Background="{StaticResource PrimaryLightBrush}"
                            Foreground="White"
                            BorderThickness="0"
                            CornerRadius="20"
                            Click="UsersTabButton_Click" />

                    <!-- TAB 2: Roles & Permissions -->
                    <Button x:Name="RolesTabButton"
                            Grid.Column="1"
                            Content="Roles &amp; Permissions"
                            FontSize="13"
                            FontWeight="SemiBold"
                            HorizontalAlignment="Stretch"
                            Padding="0,6"
                            Background="{StaticResource BackgroundPrimaryBrush}"
                            Foreground="{StaticResource TextSecondaryBrush}"
                            BorderThickness="0"
                            CornerRadius="20"
                            Click="RolesTabButton_Click" />
                </Grid>
            </Border>

            <!-- ============ USERS TAB ============ -->
            <StackPanel x:Name="UsersSection" Spacing="16">

                <!-- STATS CARDS -->
                <Grid ColumnSpacing="16">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <!-- Total Users -->
                    <Border Grid.Column="0"
                            Background="{StaticResource BackgroundPrimaryBrush}"
                            CornerRadius="18"
                            Padding="16"
                            BorderBrush="{StaticResource BorderLightBrush}"
                            BorderThickness="1">
                        <StackPanel Spacing="8">
                            <TextBlock Text="Total Users"
                                       Foreground="{StaticResource TextSecondaryBrush}" />
                            <TextBlock Text="{Binding TotalUsers}"
                                       FontSize="26"
                                       FontWeight="Bold"
                                       Foreground="{StaticResource TextPrimaryBrush}" />
                        </StackPanel>
                    </Border>

                    <!-- Active Users -->
                    <Border Grid.Column="1"
                            Background="{StaticResource BackgroundPrimaryBrush}"
                            CornerRadius="18"
                            Padding="16"
                            BorderBrush="{StaticResource BorderLightBrush}"
                            BorderThickness="1">
                        <StackPanel Spacing="8">
                            <TextBlock Text="Active Users"
                                       Foreground="{StaticResource TextSecondaryBrush}" />
                            <StackPanel Orientation="Horizontal"
                                        Spacing="8"
                                        VerticalAlignment="Center">
                                <Ellipse Width="8" Height="8"
                                         Fill="{StaticResource SeverityLowBrush}"
                                         VerticalAlignment="Center" />
                                <TextBlock Text="{Binding ActiveUsers}"
                                           FontSize="26"
                                           FontWeight="Bold"
                                           Foreground="{StaticResource TextPrimaryBrush}" />
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <!-- Locked Users -->
                    <Border Grid.Column="2"
                            Background="{StaticResource BackgroundPrimaryBrush}"
                            CornerRadius="18"
                            Padding="16"
                            BorderBrush="{StaticResource BorderLightBrush}"
                            BorderThickness="1">
                        <StackPanel Spacing="8">
                            <TextBlock Text="Locked"
                                       Foreground="{StaticResource TextSecondaryBrush}" />
                            <TextBlock Text="{Binding LockedUsers}"
                                       FontSize="26"
                                       FontWeight="Bold"
                                       Foreground="{StaticResource TextPrimaryBrush}" />
                        </StackPanel>
                    </Border>

                    <!-- Pending (placeholder) -->
                    <Border Grid.Column="3"
                            Background="{StaticResource BackgroundPrimaryBrush}"
                            CornerRadius="18"
                            Padding="16"
                            BorderBrush="{StaticResource BorderLightBrush}"
                            BorderThickness="1">
                        <StackPanel Spacing="8">
                            <TextBlock Text="Pending"
                                       Foreground="{StaticResource TextSecondaryBrush}" />
                            <TextBlock Text="0"
                                       FontSize="26"
                                       FontWeight="Bold"
                                       Foreground="{StaticResource TextPrimaryBrush}" />
                        </StackPanel>
                    </Border>
                </Grid>

                <!-- SEARCH + FILTER + ADD BUTTON -->
                <Grid ColumnSpacing="12">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="2*" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <TextBox x:Name="SearchBox"
                             Grid.Column="0"
                             PlaceholderText="Tìm kiếm người dùng..."
                             Background="{StaticResource BackgroundPrimaryBrush}"
                             BorderBrush="{StaticResource BorderLightBrush}" />

                    <ComboBox Grid.Column="1"
                              Width="140"
                              Background="{StaticResource BackgroundPrimaryBrush}"
                              BorderBrush="{StaticResource BorderLightBrush}">
                        <ComboBoxItem Content="All Types" IsSelected="True" />
                        <ComboBoxItem Content="Admin" />
                        <ComboBoxItem Content="Operator" />
                        <ComboBoxItem Content="Viewer" />
                    </ComboBox>

                    <ComboBox Grid.Column="2"
                              Width="140"
                              Background="{StaticResource BackgroundPrimaryBrush}"
                              BorderBrush="{StaticResource BorderLightBrush}">
                        <ComboBoxItem Content="All Status" IsSelected="True" />
                        <ComboBoxItem Content="Active" />
                        <ComboBoxItem Content="Locked" />
                    </ComboBox>

                    <Button Grid.Column="3"
                            Content="Thêm"
                            Click="AddUser_Click"
                            Margin="8,0,0,0"
                            Style="{StaticResource AccentButtonStyle}" />
                </Grid>

                <!-- USERS TABLE -->
                <Border Background="{StaticResource BackgroundPrimaryBrush}"
                        CornerRadius="18"
                        Padding="16"
                        BorderBrush="{StaticResource BorderLightBrush}"
                        BorderThickness="1">
                    <StackPanel Spacing="12">

                        <!-- Title & subtitle -->
                        <StackPanel Spacing="2">
                            <TextBlock Text="Users &amp; Contractors"
                                       FontWeight="SemiBold"
                                       FontSize="16"
                                       Foreground="{StaticResource TextPrimaryBrush}" />
                            <TextBlock Foreground="{StaticResource TextSecondaryBrush}">
                                <Run Text="Showing " />
                                <Run Text="{Binding TotalUsers}" />
                                <Run Text=" users" />
                            </TextBlock>
                        </StackPanel>

                        <!-- Header row -->
                        <Grid Padding="0,4"
                              Margin="0,4,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="3*" />
                                <ColumnDefinition Width="3*" />
                                <ColumnDefinition Width="2*" />
                                <ColumnDefinition Width="2*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <TextBlock Grid.Column="0"
                                       Text="Name"
                                       FontWeight="SemiBold"
                                       Foreground="{StaticResource TextSecondaryBrush}" />
                            <TextBlock Grid.Column="1"
                                       Text="Email"
                                       FontWeight="SemiBold"
                                       Foreground="{StaticResource TextSecondaryBrush}" />
                            <TextBlock Grid.Column="2"
                                       Text="Role"
                                       FontWeight="SemiBold"
                                       Foreground="{StaticResource TextSecondaryBrush}" />
                            <TextBlock Grid.Column="3"
                                       Text="Status"
                                       FontWeight="SemiBold"
                                       Foreground="{StaticResource TextSecondaryBrush}" />
                            <TextBlock Grid.Column="4"
                                       Text="Actions"
                                       FontWeight="SemiBold"
                                       HorizontalAlignment="Right"
                                       Foreground="{StaticResource TextSecondaryBrush}" />
                        </Grid>

                        <ListView x:Name="UsersListView"
                                  ItemsSource="{Binding Users}"
                                  SelectedItem="{Binding SelectedUser, Mode=TwoWay}"
                                  Background="Transparent"
                                  BorderThickness="0">
                            <ListView.ItemContainerStyle>
                                <Style TargetType="ListViewItem">
                                    <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                                    <Setter Property="Padding" Value="0" />
                                    <Setter Property="Margin" Value="0,2" />
                                    <Setter Property="Background" Value="Transparent" />
                                </Style>
                            </ListView.ItemContainerStyle>

                            <ListView.ItemTemplate>
                                <DataTemplate x:DataType="vm:UserItem">
                                    <Border Background="{StaticResource BackgroundSecondaryBrush}"
                                            CornerRadius="12"
                                            Padding="10"
                                            BorderBrush="{StaticResource BorderLightBrush}"
                                            BorderThickness="0">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="3*" />
                                                <ColumnDefinition Width="3*" />
                                                <ColumnDefinition Width="2*" />
                                                <ColumnDefinition Width="2*" />
                                                <ColumnDefinition Width="Auto" />
                                            </Grid.ColumnDefinitions>

                                            <!-- Name -->
                                            <TextBlock Grid.Column="0"
                                                       Text="{x:Bind FullName}"
                                                       Foreground="{StaticResource TextPrimaryBrush}" />

                                            <!-- Email -->
                                            <TextBlock Grid.Column="1"
                                                       Text="{x:Bind Email}"
                                                       Foreground="{StaticResource TextSecondaryBrush}" />

                                            <!-- Role -->
                                            <Border Grid.Column="2"
                                                    Background="{StaticResource BackgroundPrimaryBrush}"
                                                    CornerRadius="10"
                                                    Padding="8,2"
                                                    HorizontalAlignment="Left">
                                                <TextBlock Text="{x:Bind Role}"
                                                           FontSize="12"
                                                           Foreground="{StaticResource TextPrimaryBrush}" />
                                            </Border>

                                            <!-- Status (pill gọn, chấm màu + chữ) -->
                                            <Border Grid.Column="3"
        Background="{StaticResource BackgroundPrimaryBrush}"
        CornerRadius="10"
        Padding="6,2"
        HorizontalAlignment="Center">
                                                <StackPanel Orientation="Horizontal"
                Spacing="6"
                VerticalAlignment="Center">
                                                    <!-- chấm màu theo StatusBrush -->
                                                    <Ellipse Width="8"
                 Height="8"
                 Fill="{x:Bind StatusBrush}"
                 VerticalAlignment="Center" />
                                                    <TextBlock Text="{x:Bind StatusText}"
                   FontSize="11"
                   FontWeight="SemiBold"
                   Foreground="{StaticResource TextPrimaryBrush}" />
                                                </StackPanel>
                                            </Border>


                                            <!-- Actions -->
                                            <StackPanel Grid.Column="4"
                                                        Orientation="Horizontal"
                                                        Spacing="8"
                                                        HorizontalAlignment="Right">
                                                <Button Content="Sửa"
                                                        Click="EditUser_Click"
                                                        Style="{StaticResource SubtleButtonStyle}" />
                                                <Button Content="Xóa"
                                                        Click="DeleteUser_Click"
                                                        Style="{StaticResource SubtleButtonStyle}" />
                                            </StackPanel>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>

                    </StackPanel>
                </Border>
            </StackPanel>

            <!-- ============ ROLES TAB ============ -->
            <StackPanel x:Name="RolesSection"
                        Spacing="16"
                        Visibility="Collapsed">

                <!-- STATS CARDS FOR ROLES TAB -->
                <Grid ColumnSpacing="16">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <!-- Total Roles -->
                    <Border Grid.Column="0"
                            Background="{StaticResource BackgroundPrimaryBrush}"
                            CornerRadius="18"
                            Padding="16"
                            BorderBrush="{StaticResource BorderLightBrush}"
                            BorderThickness="1">
                        <StackPanel Spacing="8">
                            <TextBlock Text="Total Roles"
                                       Foreground="{StaticResource TextSecondaryBrush}" />
                            <TextBlock Text="{Binding TotalRoles}"
                                       FontSize="24"
                                       FontWeight="Bold"
                                       Foreground="{StaticResource TextPrimaryBrush}" />
                        </StackPanel>
                    </Border>

                    <!-- Custom Roles -->
                    <Border Grid.Column="1"
                            Background="{StaticResource BackgroundPrimaryBrush}"
                            CornerRadius="18"
                            Padding="16"
                            BorderBrush="{StaticResource BorderLightBrush}"
                            BorderThickness="1">
                        <StackPanel Spacing="8">
                            <TextBlock Text="Custom Roles"
                                       Foreground="{StaticResource TextSecondaryBrush}" />
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <Ellipse Width="8" Height="8"
                                         VerticalAlignment="Center"
                                         Fill="{StaticResource SeverityMediumBrush}" />
                                <TextBlock Text="{Binding CustomRoles}"
                                           FontSize="24"
                                           FontWeight="Bold"
                                           Foreground="{StaticResource TextPrimaryBrush}" />
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <!-- Total Users -->
                    <Border Grid.Column="2"
                            Background="{StaticResource BackgroundPrimaryBrush}"
                            CornerRadius="18"
                            Padding="16"
                            BorderBrush="{StaticResource BorderLightBrush}"
                            BorderThickness="1">
                        <StackPanel Spacing="8">
                            <TextBlock Text="Total Users"
                                       Foreground="{StaticResource TextSecondaryBrush}" />
                            <TextBlock Text="{Binding TotalUsers}"
                                       FontSize="24"
                                       FontWeight="Bold"
                                       Foreground="{StaticResource TextPrimaryBrush}" />
                        </StackPanel>
                    </Border>

                    <!-- Avg Permissions -->
                    <Border Grid.Column="3"
                            Background="{StaticResource BackgroundPrimaryBrush}"
                            CornerRadius="18"
                            Padding="16"
                            BorderBrush="{StaticResource BorderLightBrush}"
                            BorderThickness="1">
                        <StackPanel Spacing="8">
                            <TextBlock Text="Avg Permissions"
                                       Foreground="{StaticResource TextSecondaryBrush}" />
                            <TextBlock Text="{Binding AvgPermissions}"
                                       FontSize="24"
                                       FontWeight="Bold"
                                       Foreground="{StaticResource TextPrimaryBrush}" />
                        </StackPanel>
                    </Border>
                </Grid>

                <!-- MAIN ROLES LAYOUT: LIST + DETAILS -->
                <Grid ColumnSpacing="20">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="3*" />
                        <ColumnDefinition Width="2*" />
                    </Grid.ColumnDefinitions>

                    <!-- DANH SÁCH ROLES (BÊN TRÁI) -->
                    <Border Grid.Column="0"
                            Background="{StaticResource BackgroundPrimaryBrush}"
                            CornerRadius="18"
                            Padding="16"
                            BorderBrush="{StaticResource BorderLightBrush}"
                            BorderThickness="1">
                        <StackPanel Spacing="12">

                            <Grid>
                                <TextBlock Text="Roles"
                                           FontSize="16"
                                           FontWeight="SemiBold"
                                           Foreground="{StaticResource TextPrimaryBrush}" />
                                <Button Content="Create Role"
        HorizontalAlignment="Right"
        Padding="12,4"
        Style="{StaticResource AccentButtonStyle}"
        Click="AddRole_Click"/>

                            </Grid>

                            <!-- small stats row -->
                            <Grid ColumnSpacing="12">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>

                                <StackPanel Grid.Column="0" Spacing="2">
                                    <TextBlock Text="Total Roles"
                                               FontSize="12"
                                               Foreground="{StaticResource TextSecondaryBrush}" />
                                    <TextBlock Text="{Binding TotalRoles}"
                                               FontSize="18"
                                               FontWeight="Bold"
                                               Foreground="{StaticResource TextPrimaryBrush}" />
                                </StackPanel>

                                <StackPanel Grid.Column="1" Spacing="2">
                                    <TextBlock Text="Custom Roles"
                                               FontSize="12"
                                               Foreground="{StaticResource TextSecondaryBrush}" />
                                    <TextBlock Text="{Binding CustomRoles}"
                                               FontSize="18"
                                               FontWeight="Bold"
                                               Foreground="{StaticResource TextPrimaryBrush}" />
                                </StackPanel>
                            </Grid>

                            <!-- ROLES LIST -->
                            <ListView x:Name="RolesListView"
                                      ItemsSource="{Binding Roles}"
                                      SelectedItem="{Binding SelectedRole, Mode=TwoWay}"
                                      SelectionMode="Single"
                                      Background="Transparent"
                                      BorderThickness="0">
                                <ListView.ItemContainerStyle>
                                    <Style TargetType="ListViewItem">
                                        <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                                        <Setter Property="Padding" Value="0" />
                                        <Setter Property="Margin" Value="0,4" />
                                        <Setter Property="Background" Value="Transparent" />
                                    </Style>
                                </ListView.ItemContainerStyle>

                                <ListView.ItemTemplate>
                                    <DataTemplate x:DataType="vm:RoleItem">
                                        <Border Background="{StaticResource BackgroundSecondaryBrush}"
                                                CornerRadius="14"
                                                Padding="12">
                                            <Grid>
                                                <Grid.RowDefinitions>
                                                    <RowDefinition Height="Auto" />
                                                    <RowDefinition Height="Auto" />
                                                    <RowDefinition Height="Auto" />
                                                </Grid.RowDefinitions>

                                                <!-- Name + badge -->
                                                <StackPanel Orientation="Horizontal"
                                                            Spacing="8">
                                                    <TextBlock Text="{x:Bind Name}"
                                                               FontWeight="SemiBold"
                                                               Foreground="{StaticResource TextPrimaryBrush}" />
                                                    <Border Style="{StaticResource ChipBadgeBorderStyle}"
                                                            Background="{x:Bind BadgeBrush}">
                                                        <TextBlock Style="{StaticResource ChipBadgeTextStyle}"
                                                                   Text="{x:Bind KindText}" />
                                                    </Border>
                                                </StackPanel>

                                                <!-- Description -->
                                                <TextBlock Grid.Row="1"
                                                           Text="{x:Bind Description}"
                                                           Margin="0,4,0,0"
                                                           Foreground="{StaticResource TextSecondaryBrush}"
                                                           TextWrapping="Wrap"
                                                           MaxLines="2" />

                                                <!-- Footer: perms + users -->
                                                <!-- Footer: perms + users + actions -->
                                                <Grid Grid.Row="2"
      Margin="0,8,0,0"
      ColumnDefinitions="Auto,*,Auto">

                                                    <!-- Perms -->
                                                    <StackPanel Grid.Column="0"
                Orientation="Horizontal"
                Spacing="4">
                                                        <TextBlock Text="Perms:"
                   FontSize="12"
                   Foreground="{StaticResource TextSecondaryBrush}"/>
                                                        <TextBlock Text="{x:Bind PermissionsCount}"
                   FontSize="12"
                   Foreground="{StaticResource TextSecondaryBrush}"/>
                                                    </StackPanel>

                                                    <!-- Users -->
                                                    <StackPanel Grid.Column="1"
                Orientation="Horizontal"
                HorizontalAlignment="Left"
                Margin="16,0,0,0"
                Spacing="4">
                                                        <TextBlock Text="Users:"
                   FontSize="12"
                   Foreground="{StaticResource TextSecondaryBrush}"/>
                                                        <TextBlock Text="{x:Bind UsersCount}"
                   FontSize="12"
                   Foreground="{StaticResource TextSecondaryBrush}"/>
                                                    </StackPanel>

                                                    <!-- Actions -->
                                                    <StackPanel Grid.Column="2"
                Orientation="Horizontal"
                HorizontalAlignment="Right"
                Spacing="6">
                                                        <Button Content="Sửa"
                Click="EditRole_Click"
                Style="{StaticResource SubtleButtonStyle}"/>
                                                        <Button Content="Xóa"
                Click="DeleteRole_Click"
                Style="{StaticResource SubtleButtonStyle}"/>
                                                    </StackPanel>
                                                </Grid>

                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ListView.ItemTemplate>
                            </ListView>

                        </StackPanel>
                    </Border>

                    <!-- ROLE DETAILS (BÊN PHẢI – HẸP HƠN) -->
                    <Border Grid.Column="1"
                            Background="{StaticResource BackgroundPrimaryBrush}"
                            CornerRadius="18"
                            Padding="20"
                            BorderBrush="{StaticResource BorderLightBrush}"
                            BorderThickness="1">
                        <StackPanel Spacing="16">

                            <TextBlock Text="Role Details"
                                       FontSize="16"
                                       FontWeight="SemiBold"
                                       Foreground="{StaticResource TextPrimaryBrush}" />

                            <!-- Selected role basic info -->
                            <StackPanel Spacing="6">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <TextBlock Text="{Binding SelectedRole.Name}"
                                               FontSize="15"
                                               FontWeight="SemiBold"
                                               Foreground="{StaticResource TextPrimaryBrush}" />

                                    <Border Style="{StaticResource ChipBadgeBorderStyle}"
                                            Background="{Binding SelectedRole.BadgeBrush}">
                                        <TextBlock Style="{StaticResource ChipBadgeTextStyle}"
                                                   Text="{Binding SelectedRole.KindText}" />
                                    </Border>
                                </StackPanel>

                                <TextBlock Text="{Binding SelectedRole.Description}"
                                           Foreground="{StaticResource TextSecondaryBrush}"
                                           TextWrapping="Wrap" />
                            </StackPanel>

                            <!-- Users with this role -->
                            <StackPanel Spacing="4">
                                <TextBlock Text="Users with this role:"
                                           FontWeight="SemiBold"
                                           Foreground="{StaticResource TextPrimaryBrush}" />

                                <StackPanel Orientation="Horizontal" Spacing="6">
                                    <TextBlock Text="{Binding SelectedRole.UsersCount}"
                                               FontWeight="SemiBold"
                                               Foreground="{StaticResource TextPrimaryBrush}" />
                                    <TextBlock Text="users"
                                               Foreground="{StaticResource TextSecondaryBrush}" />
                                </StackPanel>
                            </StackPanel>

                            <!-- Permissions list -->
                            <StackPanel Spacing="6">
                                <StackPanel Orientation="Horizontal" Spacing="6">
                                    <TextBlock Text="Permissions"
                                               FontWeight="SemiBold"
                                               Foreground="{StaticResource TextPrimaryBrush}" />
                                    <TextBlock Text="("
                                               Foreground="{StaticResource TextSecondaryBrush}" />
                                    <TextBlock Text="{Binding SelectedRole.PermissionsCount}"
                                               Foreground="{StaticResource TextSecondaryBrush}" />
                                    <TextBlock Text=")"
                                               Foreground="{StaticResource TextSecondaryBrush}" />
                                </StackPanel>

                                <ItemsControl ItemsSource="{Binding SelectedRole.Permissions}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal"
                                                        Spacing="8"
                                                        Margin="0,2,0,2">
                                                <Ellipse Width="6"
                                                         Height="6"
                                                         Fill="{StaticResource SeverityLowBrush}"
                                                         VerticalAlignment="Center" />
                                                <TextBlock Text="{Binding}"
                                                           Foreground="{StaticResource TextSecondaryBrush}"
                                                           TextWrapping="Wrap" />
                                            </StackPanel>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </StackPanel>

                        </StackPanel>
                    </Border>
                </Grid>

            </StackPanel>

        </StackPanel>
    </ScrollViewer>
</Page>
