<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="Station.Views.LiveVideoPage"
    x:Name="PageRoot"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:viewmodels="using:Station.ViewModels"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Background="{StaticResource BackgroundSecondaryBrush}">

	<Grid Padding="32,24">
		<Grid.RowDefinitions>
			<RowDefinition Height="Auto"/>
			<RowDefinition Height="*"/>
		</Grid.RowDefinitions>

		<!-- Header Section -->
		<Grid Grid.Row="0" Margin="0,0,0,24">
			<Grid.ColumnDefinitions>
				<ColumnDefinition Width="*"/>
				<ColumnDefinition Width="Auto"/>
			</Grid.ColumnDefinitions>

			<!-- Title and Stats -->
			<StackPanel Grid.Column="0" Spacing="12">
				<TextBlock Text="Video Trực tiếp / AI Snapshot"
                           Style="{StaticResource TitleTextBlockStyle}"/>

				<StackPanel Orientation="Horizontal" Spacing="24">
					<!-- Active Cameras Stat -->
					<StackPanel Orientation="Horizontal" Spacing="8">
						<Border Background="{StaticResource SeverityLowLightBrush}"
                                CornerRadius="8"
                                Width="40" Height="40"
                                Padding="8">
							<FontIcon Glyph="&#xE714;"
                                      Foreground="{StaticResource SeverityLowBrush}"
                                      FontSize="20"/>
						</Border>
						<StackPanel VerticalAlignment="Center">
							<TextBlock FontSize="{StaticResource FontSizeSmall}"
                                       Foreground="{StaticResource TextSecondaryBrush}"
                                       Text="Cameras Online"/>
							<TextBlock FontSize="{StaticResource FontSizeLarge}"
                                       FontWeight="Bold"
                                       Foreground="{StaticResource SeverityLowBrush}">
								<Run Text="{x:Bind ViewModel.ActiveCameras, Mode=OneWay}"/>
								<Run Text="/" FontWeight="Normal" Foreground="{StaticResource TextTertiaryBrush}"/>
								<Run Text="{x:Bind ViewModel.TotalCameras, Mode=OneWay}"
                                     FontWeight="Normal" Foreground="{StaticResource TextTertiaryBrush}"/>
							</TextBlock>
						</StackPanel>
					</StackPanel>

					<!-- Current Layout -->
					<Border Background="{StaticResource PrimaryLightBrush}"
                            CornerRadius="8"
                            Padding="16,8"
                            VerticalAlignment="Center">
						<StackPanel Orientation="Horizontal" Spacing="8">
							<FontIcon Glyph="&#xE80A;"
                                      FontSize="16"
                                      Foreground="{StaticResource PrimaryDarkBrush}"/>
							<TextBlock Text="{x:Bind ViewModel.SelectedLayoutText, Mode=OneWay}"
                                       FontSize="{StaticResource FontSizeSmall}"
                                       Foreground="{StaticResource PrimaryDarkBrush}"
                                       FontWeight="SemiBold"/>
						</StackPanel>
					</Border>
				</StackPanel>
			</StackPanel>

			<!-- Action Buttons -->
			<StackPanel Grid.Column="1"
                        Orientation="Horizontal"
                        Spacing="12"
                        VerticalAlignment="Center">

				<!-- Layout Selector -->
				<Button Style="{StaticResource SecondaryButtonStyle}"
                        MinWidth="140">
					<Button.Flyout>
						<MenuFlyout Placement="BottomEdgeAlignedLeft">
							<MenuFlyoutItem Text="1×1 - Single View"
                                            Command="{x:Bind ViewModel.ChangeLayoutCommand}"
                                            CommandParameter="1">
								<MenuFlyoutItem.Icon>
									<FontIcon Glyph="&#xE8A9;"/>
								</MenuFlyoutItem.Icon>
							</MenuFlyoutItem>
							<MenuFlyoutItem Text="2×2 - Quad View"
                                            Command="{x:Bind ViewModel.ChangeLayoutCommand}"
                                            CommandParameter="4">
								<MenuFlyoutItem.Icon>
									<FontIcon Glyph="&#xE89A;"/>
								</MenuFlyoutItem.Icon>
							</MenuFlyoutItem>
							<MenuFlyoutItem Text="3×3 - Grid View"
                                            Command="{x:Bind ViewModel.ChangeLayoutCommand}"
                                            CommandParameter="9">
								<MenuFlyoutItem.Icon>
									<FontIcon Glyph="&#xE80A;"/>
								</MenuFlyoutItem.Icon>
							</MenuFlyoutItem>
							<MenuFlyoutItem Text="4×4 - Matrix View"
                                            Command="{x:Bind ViewModel.ChangeLayoutCommand}"
                                            CommandParameter="16">
								<MenuFlyoutItem.Icon>
									<FontIcon Glyph="&#xE8FE;"/>
								</MenuFlyoutItem.Icon>
							</MenuFlyoutItem>
						</MenuFlyout>
					</Button.Flyout>
					<StackPanel Orientation="Horizontal" Spacing="8">
						<FontIcon Glyph="&#xE80A;" FontSize="16"/>
						<TextBlock Text="Change Layout"/>
					</StackPanel>
				</Button>

				<!-- Refresh Button -->
				<Button Style="{StaticResource SecondaryButtonStyle}"
                        Command="{x:Bind ViewModel.RefreshStreamsCommand}"
                        ToolTipService.ToolTip="Refresh all camera streams">
					<StackPanel Orientation="Horizontal" Spacing="8">
						<FontIcon Glyph="&#xE72C;" FontSize="16"/>
						<TextBlock Text="Refresh"/>
					</StackPanel>
				</Button>
			</StackPanel>
		</Grid>

		<!-- Camera Grid with ScrollViewer -->
		<ScrollViewer Grid.Row="1"
                      VerticalScrollBarVisibility="Auto"
                      HorizontalScrollBarVisibility="Disabled">
			<ItemsControl ItemsSource="{x:Bind ViewModel.CameraStreams, Mode=OneWay}"
                          Padding="0,0,0,24">
				<ItemsControl.ItemsPanel>
					<ItemsPanelTemplate>
						<ItemsWrapGrid Orientation="Horizontal"
                                       ItemWidth="420"
                                       ItemHeight="340"
                                       HorizontalAlignment="Left"/>
					</ItemsPanelTemplate>
				</ItemsControl.ItemsPanel>

				<ItemsControl.ItemTemplate>
					<DataTemplate x:DataType="viewmodels:CameraStreamViewModel">
						<Border Background="{StaticResource BackgroundPrimaryBrush}"
                                BorderBrush="{StaticResource BorderLightBrush}"
                                BorderThickness="1"
                                CornerRadius="8"
                                Margin="0,0,16,16"
                                Padding="0">
							<Grid>
								<Grid.RowDefinitions>
									<RowDefinition Height="Auto"/>
									<RowDefinition Height="*"/>
									<RowDefinition Height="Auto"/>
								</Grid.RowDefinitions>

								<!-- Camera Header -->
								<Grid Grid.Row="0"
                                      Background="{StaticResource BackgroundSecondaryBrush}"
                                      Padding="12,10">
									<Grid.ColumnDefinitions>
										<ColumnDefinition Width="*"/>
										<ColumnDefinition Width="Auto"/>
									</Grid.ColumnDefinitions>

									<!-- Camera Name and Status -->
									<StackPanel Grid.Column="0"
                                                Orientation="Horizontal"
                                                Spacing="10">
										<Ellipse Width="10" Height="10"
                                                 Fill="{x:Bind StatusColor, Mode=OneWay}"
                                                 VerticalAlignment="Center"/>
										<TextBlock Text="{x:Bind CameraName}"
                                                   FontWeight="SemiBold"
                                                   FontSize="{StaticResource FontSizeSmall}"
                                                   Foreground="{StaticResource TextPrimaryBrush}"
                                                   VerticalAlignment="Center"/>
									</StackPanel>

									<!-- Recording and Menu -->
									<StackPanel Grid.Column="1"
                                                Orientation="Horizontal"
                                                Spacing="8">
										<!-- Recording Indicator -->
										<Border Background="{x:Bind RecordingColor, Mode=OneWay}"
                                                CornerRadius="12"
                                                Width="24" Height="24"
                                                Visibility="{x:Bind IsRecording, Mode=OneWay}"
                                                ToolTipService.ToolTip="Recording">
											<FontIcon Glyph="&#xE7C8;"
                                                      FontSize="10"
                                                      Foreground="White"/>
										</Border>

										<!-- Context Menu Button -->
										<Button Background="Transparent"
                                                BorderThickness="0"
                                                Padding="6"
                                                Width="32" Height="32"
                                                ToolTipService.ToolTip="More options">
											<FontIcon Glyph="&#xE712;" FontSize="14"/>
											<Button.Flyout>
												<MenuFlyout>
													<MenuFlyoutItem Text="Take Snapshot">
														<MenuFlyoutItem.Icon>
															<FontIcon Glyph="&#xE722;"/>
														</MenuFlyoutItem.Icon>
													</MenuFlyoutItem>
													<MenuFlyoutItem Text="Start Recording">
														<MenuFlyoutItem.Icon>
															<FontIcon Glyph="&#xE714;"/>
														</MenuFlyoutItem.Icon>
													</MenuFlyoutItem>
													<MenuFlyoutSeparator/>
													<MenuFlyoutItem Text="Settings">
														<MenuFlyoutItem.Icon>
															<FontIcon Glyph="&#xE713;"/>
														</MenuFlyoutItem.Icon>
													</MenuFlyoutItem>
												</MenuFlyout>
											</Button.Flyout>
										</Button>
									</StackPanel>
								</Grid>

								<!-- Video Display Area -->
								<Border Grid.Row="1"
                                        Background="Black"
                                        CornerRadius="0"
                                        MinHeight="220">
									<Grid>
										<!-- Video Placeholder with Diagonal Stripes -->
										<Canvas>
											<Rectangle Width="2000" Height="2000"
                                                       Canvas.Left="-500" Canvas.Top="-500"
                                                       RenderTransformOrigin="0.5,0.5">
												<Rectangle.Fill>
													<LinearGradientBrush StartPoint="0,0" EndPoint="1,1" SpreadMethod="Repeat">
														<GradientStop Color="#0F0F0F" Offset="0"/>
														<GradientStop Color="#0F0F0F" Offset="0.48"/>
														<GradientStop Color="#1A1A1A" Offset="0.5"/>
														<GradientStop Color="#1A1A1A" Offset="0.98"/>
													</LinearGradientBrush>
												</Rectangle.Fill>
												<Rectangle.RenderTransform>
													<RotateTransform Angle="45"/>
												</Rectangle.RenderTransform>
											</Rectangle>
										</Canvas>

										<!-- No Signal Overlay -->
										<StackPanel HorizontalAlignment="Center"
                                                    VerticalAlignment="Center"
                                                    Spacing="12"
                                                    Visibility="{x:Bind IsOnline, Mode=OneWay, Converter={StaticResource InverseBoolToVisibilityConverter}}">
											<FontIcon Glyph="&#xE7BA;"
                                                      FontSize="48"
                                                      Foreground="#404040"/>
											<TextBlock Text="No Signal"
                                                       FontSize="{StaticResource FontSizeMedium}"
                                                       Foreground="#606060"/>
											<TextBlock Text="Camera Offline"
                                                       FontSize="{StaticResource FontSizeSmall}"
                                                       Foreground="#505050"/>
										</StackPanel>

										<!-- Stream Info Overlay (Top Right) -->
										<StackPanel HorizontalAlignment="Right"
                                                    VerticalAlignment="Top"
                                                    Margin="12"
                                                    Spacing="6"
                                                    Visibility="{x:Bind IsOnline, Mode=OneWay}">
											<Border Background="#CC000000"
                                                    CornerRadius="4"
                                                    Padding="8,4">
												<TextBlock Text="{x:Bind BitrateDisplay, Mode=OneWay}"
                                                           FontSize="11"
                                                           FontWeight="SemiBold"
                                                           Foreground="White"/>
											</Border>
										</StackPanel>

										<!-- Camera Name Overlay (Bottom Left) -->
										<Border HorizontalAlignment="Left"
                                                VerticalAlignment="Bottom"
                                                Background="#CC000000"
                                                CornerRadius="0,4,0,0"
                                                Padding="10,6"
                                                Margin="0,0,0,0"
                                                Visibility="{x:Bind IsOnline, Mode=OneWay}">
											<TextBlock Text="{x:Bind CameraId}"
                                                       FontSize="12"
                                                       FontWeight="SemiBold"
                                                       Foreground="White"/>
										</Border>
									</Grid>
								</Border>

								<!-- Camera Footer Info -->
								<Grid Grid.Row="2"
                                      Background="{StaticResource BackgroundSecondaryBrush}"
                                      Padding="12,10">
									<Grid.ColumnDefinitions>
										<ColumnDefinition Width="*"/>
										<ColumnDefinition Width="Auto"/>
									</Grid.ColumnDefinitions>

									<!-- IR and HDR Status -->
									<StackPanel Grid.Column="0"
                                                Orientation="Horizontal"
                                                Spacing="12">
										<TextBlock Text="{x:Bind IrStatusDisplay}"
                                                   FontSize="11"
                                                   Foreground="{StaticResource TextSecondaryBrush}"/>
										<TextBlock Text="•"
                                                   FontSize="11"
                                                   Foreground="{StaticResource TextTertiaryBrush}"/>
										<TextBlock Text="{x:Bind HdrStatusDisplay}"
                                                   FontSize="11"
                                                   Foreground="{StaticResource TextSecondaryBrush}"/>
									</StackPanel>

									<!-- Resolution -->
									<TextBlock Grid.Column="1"
                                               Text="{x:Bind ResolutionDisplay}"
                                               FontSize="11"
                                               Foreground="{StaticResource TextTertiaryBrush}"
                                               VerticalAlignment="Center"/>
								</Grid>
							</Grid>
						</Border>
					</DataTemplate>
				</ItemsControl.ItemTemplate>
			</ItemsControl>
		</ScrollViewer>
	</Grid>
</Page>