<Page
    x:Class="Station.Views.DevicesPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:Station.ViewModels"
    Background="{StaticResource BackgroundSecondaryBrush}">

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="Auto"/>
        </Grid.ColumnDefinitions>

        <!-- Main Content (Left Column) -->
        <Grid Grid.Column="0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Header & Statistics Cards -->
            <Grid Grid.Row="0" Padding="24,20,24,16">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Header -->
                <StackPanel Grid.Row="0" Orientation="Horizontal" Spacing="16" Margin="0,0,0,16">
                    <TextBlock Text="Quáº£n lÃ½ Thiáº¿t bá»‹"
                               FontSize="22" FontWeight="Bold"
                               Foreground="{StaticResource TextPrimaryBrush}"/>
                    <Border Background="{StaticResource BackgroundPrimaryBrush}"
                            CornerRadius="12" Padding="10,4" VerticalAlignment="Center"
                            BorderBrush="{StaticResource BorderLightBrush}" BorderThickness="1">
                        <TextBlock FontSize="13" FontWeight="Bold" Foreground="{StaticResource TextSecondaryBrush}">
                            <Run Text="{x:Bind ViewModel.TotalDevices, Mode=OneWay}"/>
                            <Run Text=" thiáº¿t bá»‹"/>
                        </TextBlock>
                    </Border>
                </StackPanel>

                <!-- Statistics Cards -->
                <Grid Grid.Row="1">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Online -->
                    <Border Grid.Column="0" Background="{StaticResource BackgroundPrimaryBrush}" CornerRadius="12" Padding="16" Margin="0,0,8,0"
                            BorderBrush="{StaticResource BorderLightBrush}" BorderThickness="1">
                        <StackPanel Orientation="Horizontal" Spacing="14">
                            <Border Background="#DCFCE7" CornerRadius="10" Width="44" Height="44">
                                <FontIcon Glyph="&#xE73E;" FontSize="20" Foreground="#16A34A"
                                          HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>
                            <StackPanel VerticalAlignment="Center" Spacing="2">
                                <TextBlock Text="Hoáº¡t Ä‘á»™ng" FontSize="13" Foreground="{StaticResource TextSecondaryBrush}"/>
                                <TextBlock Text="{x:Bind ViewModel.OnlineDevices, Mode=OneWay}"
                                           FontSize="24" FontWeight="Bold" Foreground="{StaticResource TextPrimaryBrush}"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <!-- Offline -->
                    <Border Grid.Column="1" Background="{StaticResource BackgroundPrimaryBrush}" CornerRadius="12" Padding="16" Margin="4,0"
                            BorderBrush="{StaticResource BorderLightBrush}" BorderThickness="1">
                        <StackPanel Orientation="Horizontal" Spacing="14">
                            <Border Background="#F1F5F9" CornerRadius="10" Width="44" Height="44">
                                <FontIcon Glyph="&#xE894;" FontSize="20" Foreground="#64748B"
                                          HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>
                            <StackPanel VerticalAlignment="Center" Spacing="2">
                                <TextBlock Text="Ngoáº¡i tuyáº¿n" FontSize="13" Foreground="{StaticResource TextSecondaryBrush}"/>
                                <TextBlock Text="{x:Bind ViewModel.OfflineDevices, Mode=OneWay}"
                                           FontSize="24" FontWeight="Bold" Foreground="{StaticResource TextPrimaryBrush}"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <!-- Fault -->
                    <Border Grid.Column="2" Background="{StaticResource BackgroundPrimaryBrush}" CornerRadius="12" Padding="16" Margin="4,0"
                            BorderBrush="{StaticResource BorderLightBrush}" BorderThickness="1">
                        <StackPanel Orientation="Horizontal" Spacing="14">
                            <Border Background="#FEE2E2" CornerRadius="10" Width="44" Height="44">
                                <FontIcon Glyph="&#xE783;" FontSize="20" Foreground="#DC2626"
                                          HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>
                            <StackPanel VerticalAlignment="Center" Spacing="2">
                                <TextBlock Text="Lá»—i" FontSize="13" Foreground="{StaticResource TextSecondaryBrush}"/>
                                <TextBlock Text="{x:Bind ViewModel.FaultDevices, Mode=OneWay}"
                                           FontSize="24" FontWeight="Bold" Foreground="{StaticResource TextPrimaryBrush}"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>
                </Grid>
            </Grid>

            <!-- Filters Bar -->
            <Border Grid.Row="1" Background="{StaticResource BackgroundPrimaryBrush}"
                    Margin="24,0" Padding="16" CornerRadius="12"
                    BorderBrush="{StaticResource BorderLightBrush}" BorderThickness="1">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- Filter Dropdowns -->
                    <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="10">
                        <!-- Line Filter -->
                        <Button MinWidth="160" Style="{StaticResource FilterDropdownButtonStyle}" x:Name="LineFilterButton">
                            <Button.Flyout>
                                <Flyout Placement="Bottom" FlyoutPresenterStyle="{StaticResource DarkFlyoutPresenterStyle}" x:Name="LineFlyout">
                                    <ListView ItemsSource="{x:Bind ViewModel.LineFilters, Mode=OneWay}"
                                              SelectedItem="{x:Bind ViewModel.SelectedLine, Mode=TwoWay}"
                                              Style="{StaticResource FlyoutListViewStyle}"
                                              MinWidth="200"
                                              ItemClick="FilterListView_ItemClick">
                                        <ListView.ItemContainerStyle>
                                            <Style TargetType="ListViewItem" BasedOn="{StaticResource FlyoutListViewItemStyle}"/>
                                        </ListView.ItemContainerStyle>
                                        <ListView.ItemTemplate>
                                            <DataTemplate x:DataType="x:String">
                                                <TextBlock Text="{x:Bind}" FontSize="13" Foreground="{StaticResource TextPrimaryBrush}"/>
                                            </DataTemplate>
                                        </ListView.ItemTemplate>
                                    </ListView>
                                </Flyout>
                            </Button.Flyout>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <FontIcon Grid.Column="0" Glyph="&#xE81D;" FontSize="14" Foreground="{StaticResource TextSecondaryBrush}"/>
                                <TextBlock Grid.Column="1" Text="{x:Bind ViewModel.SelectedLine, Mode=OneWay}" FontSize="13" Foreground="{StaticResource TextPrimaryBrush}" VerticalAlignment="Center" Margin="8,0"/>
                                <FontIcon Grid.Column="2" Glyph="&#xE70D;" FontSize="10" Foreground="{StaticResource TextTertiaryBrush}"/>
                            </Grid>
                        </Button>

                        <!-- Status Filter -->
                        <Button MinWidth="160" Style="{StaticResource FilterDropdownButtonStyle}" x:Name="StatusFilterButton">
                            <Button.Flyout>
                                <Flyout Placement="Bottom" FlyoutPresenterStyle="{StaticResource DarkFlyoutPresenterStyle}" x:Name="StatusFlyout">
                                    <ListView ItemsSource="{x:Bind ViewModel.StatusFilters, Mode=OneWay}"
                                              SelectedItem="{x:Bind ViewModel.SelectedStatus, Mode=TwoWay}"
                                              Style="{StaticResource FlyoutListViewStyle}"
                                              MinWidth="200"
                                              ItemClick="FilterListView_ItemClick">
                                        <ListView.ItemContainerStyle>
                                            <Style TargetType="ListViewItem" BasedOn="{StaticResource FlyoutListViewItemStyle}"/>
                                        </ListView.ItemContainerStyle>
                                        <ListView.ItemTemplate>
                                            <DataTemplate x:DataType="x:String">
                                                <TextBlock Text="{x:Bind}" FontSize="13" Foreground="{StaticResource TextPrimaryBrush}"/>
                                            </DataTemplate>
                                        </ListView.ItemTemplate>
                                    </ListView>
                                </Flyout>
                            </Button.Flyout>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <FontIcon Grid.Column="0" Glyph="&#xE8F8;" FontSize="14" Foreground="{StaticResource TextSecondaryBrush}"/>
                                <TextBlock Grid.Column="1" Text="{x:Bind ViewModel.SelectedStatus, Mode=OneWay}" FontSize="13" Foreground="{StaticResource TextPrimaryBrush}" VerticalAlignment="Center" Margin="8,0"/>
                                <FontIcon Grid.Column="2" Glyph="&#xE70D;" FontSize="10" Foreground="{StaticResource TextTertiaryBrush}"/>
                            </Grid>
                        </Button>
                    </StackPanel>

                    <!-- Search & Actions -->
                    <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="10">
                        <Button Style="{StaticResource PrimaryButtonStyle}" Click="AddDeviceButton_Click">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <FontIcon Glyph="&#xE710;" FontSize="12"/>
                                <TextBlock Text="ThÃªm thiáº¿t bá»‹"/>
                            </StackPanel>
                        </Button>
                        <TextBox PlaceholderText="TÃ¬m kiáº¿m..."
                                 Text="{x:Bind ViewModel.SearchText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                 MinWidth="200" Style="{StaticResource SearchTextBoxStyle}"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Devices List -->
            <Border Grid.Row="2" Margin="24,16,24,24"
                    Background="{StaticResource BackgroundSecondaryBrush}"
                    CornerRadius="12">
                <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="0,0,12,0">
                    <ItemsRepeater ItemsSource="{x:Bind ViewModel.FilteredNodes, Mode=OneWay}">
                        <ItemsRepeater.Layout>
                            <StackLayout Spacing="16"/>
                        </ItemsRepeater.Layout>
                        <ItemsRepeater.ItemTemplate>
                            <DataTemplate>
                                <!-- Node Card -->
                                <Border Background="{StaticResource BackgroundPrimaryBrush}"
                                        BorderBrush="{StaticResource BorderLightBrush}"
                                        BorderThickness="1"
                                        CornerRadius="12"
                                        Padding="0">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <!-- Node Header -->
                                        <Grid Grid.Row="0"
                                              Background="{StaticResource BackgroundAccentBrush}"
                                              Padding="20,16"
                                              CornerRadius="12,12,0,0">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>

                                            <!-- Node Icon -->
                                            <Border Grid.Column="0"
                                                    Background="{StaticResource BackgroundPrimaryBrush}"
                                                    CornerRadius="8"
                                                    Width="48"
                                                    Height="48"
                                                    Margin="0,0,16,0">
                                                <FontIcon Glyph="&#xE968;"
                                                          FontSize="24"
                                                          Foreground="{StaticResource PrimaryDarkBrush}"
                                                          HorizontalAlignment="Center"
                                                          VerticalAlignment="Center"/>
                                            </Border>

                                            <!-- Node Info -->
                                            <StackPanel Grid.Column="1" VerticalAlignment="Center" Spacing="4">
                                                <TextBlock Text="{Binding NodeName}"
                                                           FontSize="18"
                                                           FontWeight="Bold"
                                                           Foreground="{StaticResource TextPrimaryBrush}"/>
                                                <StackPanel Orientation="Horizontal" Spacing="12">
                                                    <TextBlock FontSize="13" Foreground="{StaticResource TextSecondaryBrush}">
                                                        <Run Text="Tuyáº¿n:"/>
                                                        <Run Text="{Binding LineName}" FontWeight="SemiBold"/>
                                                    </TextBlock>
                                                    <TextBlock FontSize="13" Foreground="{StaticResource TextSecondaryBrush}">
                                                        <Run Text="â€¢"/>
                                                        <Run Text="{Binding Location}"/>
                                                    </TextBlock>
                                                </StackPanel>
                                            </StackPanel>

                                            <!-- Node Status Badge -->
                                            <Border Grid.Column="2"
                                                    Background="{Binding StatusBackgroundColor}"
                                                    CornerRadius="8"
                                                    Padding="12,8"
                                                    VerticalAlignment="Center"
                                                    Margin="0,0,12,0">
                                                <StackPanel Orientation="Horizontal" Spacing="6">
                                                    <Ellipse Width="8" Height="8" Fill="{Binding StatusColor}"/>
                                                    <TextBlock Text="{Binding StatusText}"
                                                               FontSize="13"
                                                               FontWeight="SemiBold"
                                                               Foreground="{Binding StatusColor}"/>
                                                </StackPanel>
                                            </Border>

                                            <!-- Expand/Collapse Button -->
                                            <Button Grid.Column="3"
                                                    Click="NodeExpandButton_Click"
                                                    Background="Transparent"
                                                    BorderThickness="0"
                                                    Padding="8"
                                                    VerticalAlignment="Center">
                                                <FontIcon x:Name="ExpandIcon"
                                                          Glyph="&#xE70D;"
                                                          FontSize="14"
                                                          Foreground="{StaticResource TextSecondaryBrush}"/>
                                            </Button>
                                        </Grid>

                                        <!-- Sensors List (Collapsible) -->
                                        <StackPanel Grid.Row="1"
                                                    x:Name="SensorsPanel"
                                                    Padding="20"
                                                    Spacing="12"
                                                    Visibility="{Binding IsExpanded}">

                                            <!-- Sensors Header -->
                                            <Grid Margin="0,0,0,8">
                                                <TextBlock Text="Cáº£m biáº¿n trong node"
                                                           FontSize="14"
                                                           FontWeight="SemiBold"
                                                           Foreground="{StaticResource TextSecondaryBrush}"/>
                                                <TextBlock Text="{Binding SensorCountText}"
                                                           FontSize="13"
                                                           Foreground="{StaticResource TextTertiaryBrush}"
                                                           HorizontalAlignment="Right"
                                                           VerticalAlignment="Center"/>
                                            </Grid>

                                            <!-- Sensors Grid -->
                                            <ItemsRepeater ItemsSource="{Binding Sensors}">
                                                <ItemsRepeater.Layout>
                                                    <UniformGridLayout MinItemWidth="250"
                                                                       MinItemHeight="120"
                                                                       ItemsStretch="Fill"
                                                                       MinColumnSpacing="12"
                                                                       MinRowSpacing="12"/>
                                                </ItemsRepeater.Layout>
                                                <ItemsRepeater.ItemTemplate>
                                                    <DataTemplate>
                                                        <!-- Sensor Card -->
                                                        <Border Background="{StaticResource BackgroundSecondaryBrush}"
                                                                BorderBrush="{StaticResource BorderLightBrush}"
                                                                BorderThickness="1"
                                                                CornerRadius="8"
                                                                Padding="16"
                                                                PointerEntered="SensorCard_PointerEntered"
                                                                PointerExited="SensorCard_PointerExited"
                                                                Tapped="SensorCard_Tapped">
                                                            <Grid>
                                                                <Grid.RowDefinitions>
                                                                    <RowDefinition Height="Auto"/>
                                                                    <RowDefinition Height="Auto"/>
                                                                    <RowDefinition Height="*"/>
                                                                </Grid.RowDefinitions>

                                                                <!-- Sensor Header -->
                                                                <Grid Grid.Row="0" Margin="0,0,0,8">
                                                                    <Grid.ColumnDefinitions>
                                                                        <ColumnDefinition Width="Auto"/>
                                                                        <ColumnDefinition Width="*"/>
                                                                        <ColumnDefinition Width="Auto"/>
                                                                    </Grid.ColumnDefinitions>

                                                                    <FontIcon Grid.Column="0"
                                                                              Glyph="{Binding TypeIcon}"
                                                                              FontSize="18"
                                                                              Foreground="{StaticResource PrimaryDarkBrush}"
                                                                              Margin="0,0,10,0"
                                                                              VerticalAlignment="Center"/>

                                                                    <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                                                        <TextBlock Text="{Binding SensorName}"
                                                                                   FontSize="14"
                                                                                   FontWeight="SemiBold"
                                                                                   Foreground="{StaticResource TextPrimaryBrush}"
                                                                                   TextTrimming="CharacterEllipsis"/>
                                                                        <TextBlock Text="{Binding SensorType}"
                                                                                   FontSize="11"
                                                                                   Foreground="{StaticResource TextTertiaryBrush}"/>
                                                                    </StackPanel>

                                                                    <!-- Sensor Status -->
                                                                    <Ellipse Grid.Column="2"
                                                                             Width="10"
                                                                             Height="10"
                                                                             Fill="{Binding SensorStatusColor}"
                                                                             VerticalAlignment="Center"/>
                                                                </Grid>

                                                                <!-- Current Reading -->
                                                                <Border Grid.Row="1"
                                                                        Background="{StaticResource BackgroundAccentBrush}"
                                                                        CornerRadius="6"
                                                                        Padding="12,8"
                                                                        Margin="0,0,0,8">
                                                                    <Grid>
                                                                        <TextBlock Text="{Binding CurrentValue}"
                                                                                   FontSize="15"
                                                                                   FontWeight="Bold"
                                                                                   Foreground="{StaticResource PrimaryDarkBrush}"
                                                                                   HorizontalAlignment="Left"
                                                                                   VerticalAlignment="Center"/>
                                                                        <TextBlock Text="{Binding Unit}"
                                                                                   FontSize="12"
                                                                                   Foreground="{StaticResource TextSecondaryBrush}"
                                                                                   HorizontalAlignment="Right"
                                                                                   VerticalAlignment="Center"/>
                                                                    </Grid>
                                                                </Border>

                                                                <!-- Sensor Details -->
                                                                <StackPanel Grid.Row="2" Spacing="4">
                                                                    <TextBlock FontSize="11" Foreground="{StaticResource TextTertiaryBrush}">
                                                                        <Run Text="Cáº­p nháº­t:"/>
                                                                        <Run Text="{Binding LastUpdateText}"/>
                                                                    </TextBlock>
                                                                    <TextBlock FontSize="11" Foreground="{StaticResource TextTertiaryBrush}">
                                                                        <Run Text="ID:"/>
                                                                        <Run Text="{Binding SensorId}"/>
                                                                    </TextBlock>
                                                                </StackPanel>
                                                            </Grid>
                                                        </Border>
                                                    </DataTemplate>
                                                </ItemsRepeater.ItemTemplate>
                                            </ItemsRepeater>
                                        </StackPanel>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsRepeater.ItemTemplate>
                    </ItemsRepeater>
                </ScrollViewer>
            </Border>
        </Grid>

        <!-- Detail Panel (Right Sidebar) -->
        <Border Grid.Column="1" Background="{StaticResource BackgroundPrimaryBrush}"
                BorderBrush="{StaticResource BorderLightBrush}" BorderThickness="1,0,0,0"
                Width="380"
                Visibility="{x:Bind ViewModel.SelectedSensor, Mode=OneWay, Converter={StaticResource NullToVisibilityConverter}}">
            <Grid>
                <!-- Summary View -->
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Global Sidebar Header -->
                <Grid Grid.Row="0" Padding="16" BorderBrush="{StaticResource BorderLightBrush}" BorderThickness="0,0,0,1">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- Tabs -->
                    <Border Grid.Column="0" Background="Transparent" CornerRadius="8" Padding="4" HorizontalAlignment="Center">
                        <StackPanel Orientation="Horizontal" Spacing="4">
                            <!-- Info Tab -->
                            <Button Command="{x:Bind ViewModel.ShowSummaryCommand}"
                                    BorderThickness="{x:Bind ViewModel.IsSidebarSummaryVisible, Mode=OneWay, Converter={StaticResource BoolToThicknessConverter}}"
                                    BorderBrush="{x:Bind ViewModel.IsSidebarSummaryVisible, Mode=OneWay, Converter={StaticResource BoolToAccentColorConverter}}"
                                    Padding="12,6" Background="Transparent" CornerRadius="6">
                                <StackPanel Orientation="Horizontal" Spacing="6">
                                    <FontIcon Glyph="&#xE946;" FontSize="14"
                                              Foreground="{x:Bind ViewModel.IsSidebarSummaryVisible, Mode=OneWay, Converter={StaticResource BoolToAccentColorConverter}}"/>
                                    <TextBlock Text="ThÃ´ng tin" FontSize="13" FontWeight="SemiBold"
                                               Foreground="{x:Bind ViewModel.IsSidebarSummaryVisible, Mode=OneWay, Converter={StaticResource BoolToAccentColorConverter}}"/>
                                </StackPanel>
                            </Button>

                            <!-- Data Tab -->
                            <Button Command="{x:Bind ViewModel.ShowDetailsCommand}"
                                    BorderThickness="{x:Bind ViewModel.IsSidebarDetailVisible, Mode=OneWay, Converter={StaticResource BoolToThicknessConverter}}"
                                    BorderBrush="{x:Bind ViewModel.IsSidebarDetailVisible, Mode=OneWay, Converter={StaticResource BoolToAccentColorConverter}}"
                                    Padding="12,6" Background="Transparent" CornerRadius="6">
                                <StackPanel Orientation="Horizontal" Spacing="6">
                                    <FontIcon Glyph="&#xE957;" FontSize="14"
                                              Foreground="{x:Bind ViewModel.IsSidebarDetailVisible, Mode=OneWay, Converter={StaticResource BoolToAccentColorConverter}}"/>
                                    <TextBlock Text="Dá»¯ liá»‡u" FontSize="13" FontWeight="SemiBold"
                                               Foreground="{x:Bind ViewModel.IsSidebarDetailVisible, Mode=OneWay, Converter={StaticResource BoolToAccentColorConverter}}"/>
                                </StackPanel>
                            </Button>

                            <!-- Config Tab -->
                            <Button Command="{x:Bind ViewModel.ShowEditCommand}"
                                    BorderThickness="{x:Bind ViewModel.IsSidebarEditVisible, Mode=OneWay, Converter={StaticResource BoolToThicknessConverter}}"
                                    BorderBrush="{x:Bind ViewModel.IsSidebarEditVisible, Mode=OneWay, Converter={StaticResource BoolToAccentColorConverter}}"
                                    Padding="12,6" Background="Transparent" CornerRadius="6">
                                <StackPanel Orientation="Horizontal" Spacing="6">
                                    <FontIcon Glyph="&#xE713;" FontSize="14"
                                              Foreground="{x:Bind ViewModel.IsSidebarEditVisible, Mode=OneWay, Converter={StaticResource BoolToAccentColorConverter}}"/>
                                    <TextBlock Text="Cáº¥u hÃ¬nh" FontSize="13" FontWeight="SemiBold"
                                               Foreground="{x:Bind ViewModel.IsSidebarEditVisible, Mode=OneWay, Converter={StaticResource BoolToAccentColorConverter}}"/>
                                </StackPanel>
                            </Button>
                        </StackPanel>
                    </Border>

                    <!-- Close Button -->
                    <Button Grid.Column="1" Style="{StaticResource IconButtonStyle}"
                            Command="{x:Bind ViewModel.CloseSidebarCommand}" ToolTipService.ToolTip="ÄÃ³ng">
                        <FontIcon Glyph="&#xE711;" FontSize="12"/>
                    </Button>
                </Grid>

                <!-- Summary Content -->
                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto"
                              Visibility="{x:Bind ViewModel.IsSidebarSummaryVisible, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
                    <StackPanel Padding="20" Spacing="16">

                        <!-- Sensor Header -->
                        <StackPanel Spacing="8">
                            <TextBlock Text="{x:Bind ViewModel.SelectedSensor.SensorName, Mode=OneWay}"
                                       FontSize="16" FontWeight="Bold"
                                       Foreground="{StaticResource TextPrimaryBrush}" TextWrapping="Wrap"/>

                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <Border Background="{StaticResource BackgroundTertiaryBrush}"
                                        CornerRadius="4" Padding="8,4">
                                    <TextBlock Text="{x:Bind ViewModel.SelectedSensor.SensorType, Mode=OneWay}"
                                               FontSize="11" FontWeight="Bold"
                                               Foreground="{StaticResource TextSecondaryBrush}"/>
                                </Border>
                                <Border Background="{StaticResource BackgroundTertiaryBrush}" CornerRadius="4" Padding="8,4">
                                    <StackPanel Orientation="Horizontal" Spacing="4">
                                        <Ellipse Width="8" Height="8" Fill="{x:Bind ViewModel.SelectedSensor.SensorStatusColor, Mode=OneWay}"/>
                                        <TextBlock Text="Online" FontSize="11" FontWeight="Bold" Foreground="{StaticResource TextPrimaryBrush}"/>
                                    </StackPanel>
                                </Border>
                            </StackPanel>
                        </StackPanel>

                        <!-- Location Info -->
                        <StackPanel Spacing="8">
                            <TextBlock Text="ðŸ“ Vá»‹ trÃ­" FontSize="14" FontWeight="SemiBold"
                                       Foreground="{StaticResource TextPrimaryBrush}"/>
                            <Border Background="{StaticResource BackgroundSecondaryBrush}"
                                    CornerRadius="8" Padding="12">
                                <StackPanel Spacing="6">
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <TextBlock Text="Tuyáº¿n:" FontSize="12" Foreground="{StaticResource TextTertiaryBrush}" Width="60"/>
                                        <TextBlock Text="{x:Bind ViewModel.SelectedSensor.LineName, Mode=OneWay}"
                                                   FontSize="12" Foreground="{StaticResource TextPrimaryBrush}" FontWeight="SemiBold"/>
                                    </StackPanel>
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <TextBlock Text="NÃºt:" FontSize="12" Foreground="{StaticResource TextTertiaryBrush}" Width="60"/>
                                        <TextBlock Text="{x:Bind ViewModel.SelectedSensor.NodeName, Mode=OneWay}"
                                                   FontSize="12" Foreground="{StaticResource TextPrimaryBrush}" FontWeight="SemiBold"/>
                                    </StackPanel>
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <TextBlock Text="Vá»‹ trÃ­:" FontSize="12" Foreground="{StaticResource TextTertiaryBrush}" Width="60"/>
                                        <TextBlock Text="{x:Bind ViewModel.SelectedSensor.Location, Mode=OneWay}"
                                                   FontSize="12" Foreground="{StaticResource TextPrimaryBrush}"/>
                                    </StackPanel>
                                </StackPanel>
                            </Border>
                        </StackPanel>

                        <!-- Sensor Data -->
                        <StackPanel Spacing="8">
                            <TextBlock Text="ðŸ“Š Dá»¯ liá»‡u thá»i gian thá»±c" FontSize="14" FontWeight="SemiBold"
                                       Foreground="{StaticResource TextPrimaryBrush}"/>
                            <Border Background="{StaticResource BackgroundSecondaryBrush}"
                                    CornerRadius="8" Padding="12">
                                <StackPanel Spacing="6">
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <TextBlock Text="GiÃ¡ trá»‹:" FontSize="12" Foreground="{StaticResource TextTertiaryBrush}" Width="60"/>
                                        <TextBlock FontSize="14" Foreground="{StaticResource PrimaryDarkBrush}"
                                                   FontWeight="Bold">
                                            <Run Text="{x:Bind ViewModel.SelectedSensor.CurrentValue, Mode=OneWay}"/>
                                            <Run Text=" "/>
                                            <Run Text="{x:Bind ViewModel.SelectedSensor.Unit, Mode=OneWay}"/>
                                        </TextBlock>
                                    </StackPanel>
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <TextBlock Text="Cáº­p nháº­t:" FontSize="12" Foreground="{StaticResource TextTertiaryBrush}" Width="60"/>
                                        <TextBlock Text="{x:Bind ViewModel.SelectedSensor.LastUpdateText, Mode=OneWay}"
                                                   FontSize="12" Foreground="{StaticResource TextSecondaryBrush}"/>
                                    </StackPanel>
                                </StackPanel>
                            </Border>
                        </StackPanel>

                        <!-- Device Info -->
                        <StackPanel Spacing="8">
                            <TextBlock Text="â„¹ï¸ ThÃ´ng tin thiáº¿t bá»‹" FontSize="14" FontWeight="SemiBold"
                                       Foreground="{StaticResource TextPrimaryBrush}"/>
                            <Border Background="{StaticResource BackgroundSecondaryBrush}"
                                    CornerRadius="8" Padding="12">
                                <StackPanel Spacing="6">
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <TextBlock Text="ID:" FontSize="12" Foreground="{StaticResource TextTertiaryBrush}" Width="60"/>
                                        <TextBlock Text="{x:Bind ViewModel.SelectedSensor.SensorId, Mode=OneWay}"
                                                   FontSize="12" Foreground="{StaticResource TextPrimaryBrush}"/>
                                    </StackPanel>
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <TextBlock Text="HÃ£ng:" FontSize="12" Foreground="{StaticResource TextTertiaryBrush}" Width="60"/>
                                        <TextBlock Text="Bosch"
                                                   FontSize="12" Foreground="{StaticResource TextPrimaryBrush}"/>
                                    </StackPanel>
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <TextBlock Text="Firmware:" FontSize="12" Foreground="{StaticResource TextTertiaryBrush}" Width="60"/>
                                        <TextBlock Text="v2.1.0"
                                                   FontSize="12" Foreground="{StaticResource TextPrimaryBrush}"/>
                                    </StackPanel>
                                </StackPanel>
                            </Border>
                        </StackPanel>

                        <!-- Actions -->
                        <StackPanel Spacing="8">
                            <TextBlock Text="ðŸ› ï¸ Thao tÃ¡c" FontSize="14" FontWeight="SemiBold"
                                       Foreground="{StaticResource TextPrimaryBrush}"/>

                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <Button Grid.Column="0" Margin="0,0,4,0"
                                        Style="{StaticResource SecondaryButtonStyle}"
                                        HorizontalAlignment="Stretch">
                                    <StackPanel Orientation="Horizontal" Spacing="6">
                                        <FontIcon Glyph="&#xE72C;" FontSize="12"/>
                                        <TextBlock Text="LÃ m má»›i" FontSize="13"/>
                                    </StackPanel>
                                </Button>

                                <Button Grid.Column="1" Margin="4,0,0,0"
                                        Style="{StaticResource SecondaryButtonStyle}"
                                        HorizontalAlignment="Stretch">
                                    <StackPanel Orientation="Horizontal" Spacing="6">
                                        <FontIcon Glyph="&#xE711;" FontSize="12"/>
                                        <TextBlock Text="XÃ³a" FontSize="13"/>
                                    </StackPanel>
                                </Button>
                            </Grid>
                        </StackPanel>

                    </StackPanel>
                </ScrollViewer>


                <!-- Details View -->
                <!-- Details Content -->
                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Padding="20"
                              Visibility="{x:Bind ViewModel.IsSidebarDetailVisible, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
                    <StackPanel Spacing="20">
                        <!-- Current Reading Section -->
                        <StackPanel Spacing="12">
                            <TextBlock Text="GiÃ¡ trá»‹ hiá»‡n táº¡i" FontSize="16" FontWeight="SemiBold" Foreground="{StaticResource TextPrimaryBrush}"/>
                            <Border Background="{StaticResource BackgroundAccentBrush}" CornerRadius="8" Padding="24">
                                <StackPanel HorizontalAlignment="Center" Spacing="8">
                                    <TextBlock FontSize="48" FontWeight="Bold" Foreground="{StaticResource PrimaryDarkBrush}" HorizontalAlignment="Center">
                                        <Run Text="{x:Bind ViewModel.SelectedSensor.CurrentValue, Mode=OneWay}"/>
                                        <Run Text=" "/>
                                        <Run Text="{x:Bind ViewModel.SelectedSensor.Unit, Mode=OneWay}" FontSize="24"/>
                                    </TextBlock>
                                    <TextBlock Text="{x:Bind ViewModel.SelectedSensor.SensorName, Mode=OneWay}" FontSize="14" Foreground="{StaticResource TextSecondaryBrush}" HorizontalAlignment="Center"/>
                                    <TextBlock FontSize="12" Foreground="{StaticResource TextTertiaryBrush}" HorizontalAlignment="Center">
                                        <Run Text="Cáº­p nháº­t:"/>
                                        <Run Text="{x:Bind ViewModel.SelectedSensor.LastUpdateText, Mode=OneWay}"/>
                                    </TextBlock>
                                </StackPanel>
                            </Border>
                        </StackPanel>

                        <!-- Statistics Section -->
                        <StackPanel Spacing="12">
                            <TextBlock Text="Thá»‘ng kÃª 24 giá» qua" FontSize="16" FontWeight="SemiBold" Foreground="{StaticResource TextPrimaryBrush}"/>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Border Grid.Column="0" Background="{StaticResource BackgroundSecondaryBrush}" CornerRadius="8" Padding="12" Margin="0,0,4,0">
                                    <StackPanel Spacing="4">
                                        <TextBlock Text="TB" FontSize="11" Foreground="{StaticResource TextSecondaryBrush}"/>
                                        <TextBlock Text="25.5" FontSize="18" FontWeight="Bold" Foreground="{StaticResource TextPrimaryBrush}"/>
                                    </StackPanel>
                                </Border>
                                <Border Grid.Column="1" Background="{StaticResource BackgroundSecondaryBrush}" CornerRadius="8" Padding="12" Margin="4,0">
                                    <StackPanel Spacing="4">
                                        <TextBlock Text="Min" FontSize="11" Foreground="{StaticResource TextSecondaryBrush}"/>
                                        <TextBlock Text="18.2" FontSize="18" FontWeight="Bold" Foreground="{StaticResource SeverityLowBrush}"/>
                                    </StackPanel>
                                </Border>
                                <Border Grid.Column="2" Background="{StaticResource BackgroundSecondaryBrush}" CornerRadius="8" Padding="12" Margin="4,0,0,0">
                                    <StackPanel Spacing="4">
                                        <TextBlock Text="Max" FontSize="11" Foreground="{StaticResource TextSecondaryBrush}"/>
                                        <TextBlock Text="32.8" FontSize="18" FontWeight="Bold" Foreground="{StaticResource SeverityCriticalBrush}"/>
                                    </StackPanel>
                                </Border>
                            </Grid>
                        </StackPanel>

                        <!-- Recent Readings Section -->
                        <StackPanel Spacing="12">
                            <TextBlock Text="Lá»‹ch sá»­ Ä‘á»c gáº§n Ä‘Ã¢y" FontSize="16" FontWeight="SemiBold" Foreground="{StaticResource TextPrimaryBrush}"/>
                            <Border Background="{StaticResource BackgroundSecondaryBrush}" CornerRadius="8" Padding="16">
                                <StackPanel Spacing="8">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Grid.Column="0" Text="09:30:15" Foreground="{StaticResource TextTertiaryBrush}"/>
                                        <TextBlock Grid.Column="1" Text="26.5Â°C" FontWeight="SemiBold" Foreground="{StaticResource TextPrimaryBrush}"/>
                                    </Grid>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Grid.Column="0" Text="09:25:10" Foreground="{StaticResource TextTertiaryBrush}"/>
                                        <TextBlock Grid.Column="1" Text="26.3Â°C" FontWeight="SemiBold" Foreground="{StaticResource TextPrimaryBrush}"/>
                                    </Grid>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Grid.Column="0" Text="09:20:05" Foreground="{StaticResource TextTertiaryBrush}"/>
                                        <TextBlock Grid.Column="1" Text="26.1Â°C" FontWeight="SemiBold" Foreground="{StaticResource TextPrimaryBrush}"/>
                                    </Grid>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>


                <!-- Edit View -->
                <!-- Edit View -->
                <Grid Grid.Row="1" Visibility="{x:Bind ViewModel.IsSidebarEditVisible, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Content (from SensorDetailDialog Config Tab) -->
                    <ScrollViewer Grid.Row="0" VerticalScrollBarVisibility="Auto" Padding="20">
                        <StackPanel Spacing="20">
                            <!-- Sensor Information Section -->
                            <StackPanel Spacing="12">
                                <TextBlock Text="ThÃ´ng tin cáº£m biáº¿n" FontSize="14" FontWeight="SemiBold" Foreground="{StaticResource TextPrimaryBrush}"/>
                                <Border Background="{StaticResource BackgroundSecondaryBrush}" CornerRadius="8" Padding="16">
                                    <StackPanel Spacing="12">
                                        <StackPanel>
                                            <TextBlock Text="ID Cáº£m biáº¿n" Foreground="{StaticResource TextSecondaryBrush}" Margin="0,0,0,4"/>
                                            <TextBox Text="{x:Bind ViewModel.SelectedSensor.SensorId, Mode=OneWay}" IsReadOnly="True"/>
                                        </StackPanel>
                                        <StackPanel>
                                            <TextBlock Text="TÃªn cáº£m biáº¿n" Foreground="{StaticResource TextSecondaryBrush}" Margin="0,0,0,4"/>
                                            <TextBox Text="{x:Bind ViewModel.SelectedSensor.SensorName, Mode=TwoWay}"/>
                                        </StackPanel>
                                        <StackPanel>
                                            <TextBlock Text="Loáº¡i cáº£m biáº¿n" Foreground="{StaticResource TextSecondaryBrush}" Margin="0,0,0,4"/>
                                            <TextBox Text="{x:Bind ViewModel.SelectedSensor.SensorType, Mode=OneWay}" IsReadOnly="True"/>
                                        </StackPanel>
                                        <StackPanel>
                                            <TextBlock Text="Tráº¡ng thÃ¡i" Foreground="{StaticResource TextSecondaryBrush}" Margin="0,0,0,4"/>
                                            <ComboBox SelectedIndex="0" HorizontalAlignment="Stretch">
                                                <ComboBoxItem Content="Hoáº¡t Ä‘á»™ng"/>
                                                <ComboBoxItem Content="Táº¡m dá»«ng"/>
                                                <ComboBoxItem Content="Báº£o trÃ¬"/>
                                            </ComboBox>
                                        </StackPanel>
                                    </StackPanel>
                                </Border>
                            </StackPanel>

                            <!-- Threshold Settings Section -->
                            <StackPanel Spacing="12">
                                <TextBlock Text="Cáº¥u hÃ¬nh ngÆ°á»¡ng" FontSize="14" FontWeight="SemiBold" Foreground="{StaticResource TextPrimaryBrush}"/>
                                <Border Background="{StaticResource BackgroundSecondaryBrush}" CornerRadius="8" Padding="16">
                                    <StackPanel Spacing="12">
                                        <StackPanel>
                                            <TextBlock Text="NgÆ°á»¡ng tháº¥p" Foreground="{StaticResource TextSecondaryBrush}" Margin="0,0,0,4"/>
                                            <NumberBox Value="0" SpinButtonPlacementMode="Inline"/>
                                        </StackPanel>
                                        <StackPanel>
                                            <TextBlock Text="NgÆ°á»¡ng cao" Foreground="{StaticResource TextSecondaryBrush}" Margin="0,0,0,4"/>
                                            <NumberBox Value="100" SpinButtonPlacementMode="Inline"/>
                                        </StackPanel>
                                        <StackPanel>
                                            <TextBlock Text="Chu ká»³ Ä‘á»c (s)" Foreground="{StaticResource TextSecondaryBrush}" Margin="0,0,0,4"/>
                                            <NumberBox Value="5" Minimum="1" SpinButtonPlacementMode="Inline"/>
                                        </StackPanel>
                                    </StackPanel>
                                </Border>
                            </StackPanel>
                        </StackPanel>
                    </ScrollViewer>

                    <!-- Footer Actions -->
                    <Border Grid.Row="1" Padding="20,16" BorderBrush="{StaticResource BorderLightBrush}" BorderThickness="0,1,0,0" Background="{StaticResource BackgroundSecondaryBrush}">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Button Grid.Column="0" Content="Há»§y" Style="{StaticResource SecondaryButtonStyle}"
                                    HorizontalAlignment="Stretch" Margin="0,0,6,0"
                                    Command="{x:Bind ViewModel.ShowSummaryCommand}"/>
                            <Button Grid.Column="1" Content="LÆ°u thay Ä‘á»•i" Style="{StaticResource PrimaryButtonStyle}"
                                    HorizontalAlignment="Stretch" Margin="6,0,0,0"
                                    Command="{x:Bind ViewModel.ShowSummaryCommand}"/>
                        </Grid>
                    </Border>
                </Grid>
            </Grid>
        </Border>
    </Grid>
</Page>