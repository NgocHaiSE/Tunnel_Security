<Page
    x:Class="Station.Views.AlertsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:Station.ViewModels"
    xmlns:models="using:Station.Models"
    xmlns:lvc="using:LiveChartsCore.SkiaSharpView.WinUI"
    Background="{StaticResource BackgroundSecondaryBrush}">

    <Page.Resources>
        <ThemeShadow x:Key="CommonShadow"/>
        <Style x:Key="AccentButtonStyle" TargetType="Button" BasedOn="{StaticResource PrimaryButtonStyle}">
            <Setter Property="Background" Value="{StaticResource AccentBrush}"/>
        </Style>
    </Page.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="Auto"/>
        </Grid.ColumnDefinitions>

        <!-- Main Content -->
        <Grid Grid.Column="0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Header & Statistics Cards -->
            <Grid Grid.Row="0" Padding="24,20,24,16">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Header -->
                <Grid Grid.Row="0" Margin="0,0,0,16">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="16">
                        <TextBlock Text="ðŸš¨ Trung tÃ¢m Cáº£nh bÃ¡o"
                                   FontSize="24" FontWeight="Bold"
                                   Foreground="{StaticResource TextPrimaryBrush}"/>
                        <Border Background="{StaticResource BackgroundTertiaryBrush}"
                                CornerRadius="12" Padding="10,4" VerticalAlignment="Center"
                                BorderBrush="{StaticResource BorderLightBrush}" BorderThickness="1">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <FontIcon Glyph="&#xE7BA;" FontSize="12" Foreground="{StaticResource SeverityCriticalBrush}"/>
                                <TextBlock FontSize="13" FontWeight="SemiBold" Foreground="{StaticResource TextPrimaryBrush}">
                                    <Run Text="{x:Bind ViewModel.UnprocessedCount, Mode=OneWay}"/>
                                    <Run Text="chÆ°a xá»­ lÃ½" FontWeight="Normal" Foreground="{StaticResource TextSecondaryBrush}"/>
                                </TextBlock>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </Grid>

                <!-- Statistics Cards -->
                <Grid Grid.Row="1">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="1.5*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Critical -->
                    <Border Grid.Column="0" Background="{StaticResource BackgroundPrimaryBrush}"
                            CornerRadius="12" Padding="16" Margin="0,0,8,0"
                            BorderBrush="{StaticResource BorderLightBrush}" BorderThickness="1"
                            Shadow="{StaticResource CommonShadow}">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <FontIcon Glyph="&#xEB90;" FontSize="16" Foreground="#DC2626"/> <!-- Outlined Icon style approximation via font -->
                                <TextBlock Text="NghiÃªm trá»ng" FontSize="13" Foreground="{StaticResource TextSecondaryBrush}"/>
                            </StackPanel>
                            <TextBlock Grid.Row="1" Text="{x:Bind ViewModel.CriticalCount, Mode=OneWay}"
                                       FontSize="32" FontWeight="Bold" Foreground="{StaticResource TextPrimaryBrush}" Margin="0,12,0,0"/>
                        </Grid>
                    </Border>

                    <!-- High -->
                    <Border Grid.Column="1" Background="{StaticResource BackgroundPrimaryBrush}"
                            CornerRadius="12" Padding="16" Margin="4,0"
                            BorderBrush="{StaticResource BorderLightBrush}" BorderThickness="1"
                            Shadow="{StaticResource CommonShadow}">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <FontIcon Glyph="&#xE783;" FontSize="16" Foreground="#EA580C"/>
                                <TextBlock Text="Cao" FontSize="13" Foreground="{StaticResource TextSecondaryBrush}"/>
                            </StackPanel>
                            <TextBlock Grid.Row="1" Text="{x:Bind ViewModel.HighCount, Mode=OneWay}"
                                       FontSize="32" FontWeight="Bold" Foreground="{StaticResource TextPrimaryBrush}" Margin="0,12,0,0"/>
                        </Grid>
                    </Border>

                    <!-- Medium -->
                    <Border Grid.Column="2" Background="{StaticResource BackgroundPrimaryBrush}"
                            CornerRadius="12" Padding="16" Margin="4,0"
                            BorderBrush="{StaticResource BorderLightBrush}" BorderThickness="1"
                            Shadow="{StaticResource CommonShadow}">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <FontIcon Glyph="&#xE7BA;" FontSize="16" Foreground="#CA8A04"/>
                                <TextBlock Text="Trung bÃ¬nh" FontSize="13" Foreground="{StaticResource TextSecondaryBrush}"/>
                            </StackPanel>
                            <TextBlock Grid.Row="1" Text="{x:Bind ViewModel.MediumCount, Mode=OneWay}"
                                       FontSize="32" FontWeight="Bold" Foreground="{StaticResource TextPrimaryBrush}" Margin="0,12,0,0"/>
                        </Grid>
                    </Border>

                    <!-- Low -->
                    <Border Grid.Column="3" Background="{StaticResource BackgroundPrimaryBrush}"
                            CornerRadius="12" Padding="16" Margin="4,0"
                            BorderBrush="{StaticResource BorderLightBrush}" BorderThickness="1"
                            Shadow="{StaticResource CommonShadow}">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <FontIcon Glyph="&#xE946;" FontSize="16" Foreground="#16A34A"/>
                                <TextBlock Text="Tháº¥p" FontSize="13" Foreground="{StaticResource TextSecondaryBrush}"/>
                            </StackPanel>
                            <TextBlock Grid.Row="1" Text="{x:Bind ViewModel.LowCount, Mode=OneWay}"
                                       FontSize="32" FontWeight="Bold" Foreground="{StaticResource TextPrimaryBrush}" Margin="0,12,0,0"/>
                        </Grid>
                    </Border>

                    <!-- Trend Chart (Sparkline) -->
                    <Border Grid.Column="4" Background="{StaticResource BackgroundPrimaryBrush}"
                            CornerRadius="12" Padding="16,12" Margin="8,0,0,0"
                            BorderBrush="{StaticResource BorderLightBrush}" BorderThickness="1"
                            Shadow="{StaticResource CommonShadow}">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            <Grid Grid.Row="0" Margin="0,0,0,8">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <FontIcon Glyph="&#xE9D2;" FontSize="14" Foreground="{StaticResource TextSecondaryBrush}"/>
                                    <TextBlock Text="Xu hÆ°á»›ng 7 ngÃ y" FontSize="13" Foreground="{StaticResource TextSecondaryBrush}"/>
                                </StackPanel>
                                <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="4">
                                    <TextBlock Text="{x:Bind ViewModel.TodayCount, Mode=OneWay}" FontWeight="Bold" Foreground="{StaticResource TextPrimaryBrush}"/>
                                    <TextBlock Text="hÃ´m nay" FontSize="11" Foreground="{StaticResource TextTertiaryBrush}" VerticalAlignment="Bottom" Margin="0,0,0,2"/>
                                </StackPanel>
                            </Grid>

                            <!-- Sparkline Chart -->
                            <lvc:CartesianChart Grid.Row="1"
                                                Series="{x:Bind ViewModel.AlertTrendSeries, Mode=OneWay}"
                                                XAxes="{x:Bind ViewModel.AlertTrendXAxes, Mode=OneWay}"
                                                YAxes="{x:Bind ViewModel.AlertTrendYAxes, Mode=OneWay}"
                                                TooltipPosition="Hidden"
                                                Margin="0,4,0,0"/>
                        </Grid>
                    </Border>
                </Grid>
            </Grid>

            <!-- Filters Bar -->
            <Border Grid.Row="1" Background="{StaticResource BackgroundPrimaryBrush}"
                    Margin="24,0" Padding="16,12" CornerRadius="12"
                    BorderBrush="{StaticResource BorderLightBrush}" BorderThickness="1">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- Filter Dropdowns -->
                    <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="12">
                        <!-- Period Filter -->
                        <ComboBox ItemsSource="{x:Bind ViewModel.Periods}"
                                  SelectedItem="{x:Bind ViewModel.SelectedPeriod, Mode=TwoWay}"
                                  MinWidth="120" Style="{StaticResource ComboBoxStyle}"/>

                        <!-- Line Filter -->
                        <ComboBox ItemsSource="{x:Bind ViewModel.Lines}"
                                  SelectedItem="{x:Bind ViewModel.SelectedLine, Mode=TwoWay}"
                                  MinWidth="160" Style="{StaticResource ComboBoxStyle}"/>

                        <!-- Severity Filter -->
                        <ComboBox ItemsSource="{x:Bind ViewModel.Severities}"
                                  SelectedItem="{x:Bind ViewModel.SelectedSeverity, Mode=TwoWay}"
                                  MinWidth="140" Style="{StaticResource ComboBoxStyle}"/>

                        <!-- Status Filter -->
                        <ComboBox ItemsSource="{x:Bind ViewModel.Statuses}"
                                  SelectedItem="{x:Bind ViewModel.SelectedStatus, Mode=TwoWay}"
                                  MinWidth="140" Style="{StaticResource ComboBoxStyle}"/>

                        <!-- Category Filter -->
                        <ComboBox ItemsSource="{x:Bind ViewModel.Categories}"
                                  SelectedItem="{x:Bind ViewModel.SelectedCategory, Mode=TwoWay}"
                                  MinWidth="130" Style="{StaticResource ComboBoxStyle}"/>
                    </StackPanel>

                    <!-- Search & Actions -->
                    <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="12">
                        <TextBox PlaceholderText="TÃ¬m kiáº¿m..."
                                 Text="{x:Bind ViewModel.SearchQuery, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                 MinWidth="220" CornerRadius="12" Style="{StaticResource SearchTextBoxStyle}"/>

                        <Button Style="{StaticResource IconButtonStyle}"
                                Command="{x:Bind ViewModel.ClearFiltersCommand}"
                                ToolTipService.ToolTip="XÃ³a bá»™ lá»c">
                            <FontIcon Glyph="&#xE711;" FontSize="14"/>
                        </Button>

                        <!-- Refresh Icon Button -->
                        <Button Style="{StaticResource IconButtonStyle}"
                                Command="{x:Bind ViewModel.RefreshAlertsCommand}"
                                ToolTipService.ToolTip="LÃ m má»›i">
                            <FontIcon Glyph="&#xE72C;" FontSize="16"/>
                        </Button>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Alerts List -->
            <Border Grid.Row="2" Margin="24,16,24,24"
                    Background="{StaticResource BackgroundPrimaryBrush}"
                    CornerRadius="12"
                    BorderBrush="{StaticResource BorderLightBrush}" BorderThickness="1">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- List Header -->
                    <Border Grid.Row="0" Padding="20,12"
                            BorderBrush="{StaticResource BorderLightBrush}" BorderThickness="0,0,0,1">
                        <Grid>
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <TextBlock Text="Danh sÃ¡ch cáº£nh bÃ¡o" FontSize="14" FontWeight="SemiBold"
                                           Foreground="{StaticResource TextPrimaryBrush}"/>
                                <Border Background="{StaticResource BackgroundTertiaryBrush}"
                                        CornerRadius="10" Padding="8,2">
                                    <TextBlock FontSize="12" Foreground="{StaticResource TextSecondaryBrush}">
                                        <Run Text="{x:Bind ViewModel.FilteredCount, Mode=OneWay}"/>
                                        <Run Text="/"/>
                                        <Run Text="{x:Bind ViewModel.TotalAlerts, Mode=OneWay}"/>
                                    </TextBlock>
                                </Border>
                            </StackPanel>
                        </Grid>
                    </Border>

                    <!-- Scrollable Alerts -->
                    <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Padding="12">
                        <ItemsRepeater ItemsSource="{x:Bind ViewModel.FilteredAlerts, Mode=OneWay}">
                            <ItemsRepeater.ItemTemplate>
                                <DataTemplate x:DataType="local:AlertItemViewModel">
                                    <Border Background="{StaticResource BackgroundPrimaryBrush}"
                                            CornerRadius="8" Padding="16,12" Margin="0,0,0,8"
                                            BorderBrush="{StaticResource BorderLightBrush}" BorderThickness="1"
                                            PointerPressed="AlertItem_PointerPressed">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/> <!-- Status Dot -->
                                                <ColumnDefinition Width="*"/>    <!-- Content -->
                                                <ColumnDefinition Width="Auto"/> <!-- Right Info/Actions -->
                                            </Grid.ColumnDefinitions>

                                            <!-- Status Dot -->
                                            <FontIcon Grid.Column="0" Glyph="&#xE73B;" FontSize="12"
                                                      Foreground="{Binding SeverityColor}"
                                                      Margin="0,4,12,0" VerticalAlignment="Top"/>

                                            <!-- Content -->
                                            <StackPanel Grid.Column="1" Spacing="4">
                                                <StackPanel Orientation="Horizontal" Spacing="8">
                                                    <TextBlock Text="{Binding Title}" FontSize="14" FontWeight="Bold"
                                                               Foreground="{StaticResource TextPrimaryBrush}"
                                                               TextTrimming="CharacterEllipsis"/>

                                                    <!-- Category Badge as small text label -->
                                                    <Border Background="{StaticResource BackgroundTertiaryBrush}"
                                                            CornerRadius="4" Padding="6,2" VerticalAlignment="Center">
                                                        <TextBlock Text="{Binding CategoryText}" FontSize="10"
                                                                   Foreground="{StaticResource TextSecondaryBrush}"/>
                                                    </Border>
                                                </StackPanel>

                                                <StackPanel Orientation="Horizontal" Spacing="16">
                                                    <StackPanel Orientation="Horizontal" Spacing="6">
                                                        <FontIcon Glyph="&#xE81D;" FontSize="12" Foreground="{StaticResource TextTertiaryBrush}"/>
                                                        <TextBlock Text="{Binding LocationText}" FontSize="13"
                                                                   Foreground="{StaticResource TextSecondaryBrush}"/>
                                                    </StackPanel>

                                                    <StackPanel Orientation="Horizontal" Spacing="6">
                                                        <FontIcon Glyph="&#xE787;" FontSize="12" Foreground="{StaticResource TextTertiaryBrush}"/>
                                                        <TextBlock Text="{Binding TimeAgo}" FontSize="12" FontStyle="Italic"
                                                                   Foreground="{StaticResource TextTertiaryBrush}"/>
                                                    </StackPanel>
                                                </StackPanel>
                                            </StackPanel>

                                            <!-- Right Side: Status Text & Actions -->
                                            <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="16" VerticalAlignment="Center">

                                                <!-- Sensor Data (Compact) -->
                                                <Border Background="{StaticResource BackgroundSecondaryBrush}"
                                                        CornerRadius="6" Padding="8,4"
                                                        Visibility="{Binding HasSensor, Converter={StaticResource BoolToVisibilityConverter}}">
                                                    <StackPanel Orientation="Horizontal" Spacing="6">
                                                        <FontIcon Glyph="&#xE9D9;" FontSize="12" Foreground="{StaticResource TextSecondaryBrush}"/>
                                                        <TextBlock Text="{Binding SensorValueText}" FontSize="12" FontWeight="SemiBold"
                                                                   Foreground="{Binding SeverityColor}"/>
                                                    </StackPanel>
                                                </Border>

                                                <!-- Status Text -->
                                                <StackPanel Orientation="Horizontal" Spacing="6" VerticalAlignment="Center">
                                                    <FontIcon Glyph="{Binding StateIcon}" FontSize="12" Foreground="{Binding StateColor}"/>
                                                    <TextBlock Text="{Binding StateText}" FontSize="12"
                                                               Foreground="{Binding StateColor}" FontWeight="SemiBold"/>
                                                </StackPanel>

                                                <!-- Ghost Actions (Visible on Hover mechanism would usually be CSS/VisualState, here just simple ghost buttons) -->
                                                <StackPanel Orientation="Horizontal" Spacing="4">
                                                    <Button Style="{StaticResource IconButtonStyle}"
                                                            Visibility="{Binding HasCamera, Converter={StaticResource BoolToVisibilityConverter}}"
                                                            ToolTipService.ToolTip="Xem Camera">
                                                        <FontIcon Glyph="&#xE714;" FontSize="14" Foreground="{StaticResource AccentBrush}"/>
                                                    </Button>

                                                    <Button Style="{StaticResource IconButtonStyle}"
                                                            Click="ViewDetailButton_Click" Tag="{Binding}"
                                                            ToolTipService.ToolTip="Chi tiáº¿t">
                                                        <FontIcon Glyph="&#xE76C;" FontSize="14" Foreground="{StaticResource TextSecondaryBrush}"/>
                                                    </Button>
                                                </StackPanel>
                                            </StackPanel>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsRepeater.ItemTemplate>
                        </ItemsRepeater>
                    </ScrollViewer>
                </Grid>
            </Border>
        </Grid>

        <!-- Detail Panel (Right Sidebar) -->
        <Border Grid.Column="1" Background="{StaticResource BackgroundPrimaryBrush}"
                BorderBrush="{StaticResource BorderLightBrush}" BorderThickness="1,0,0,0"
                Width="380" Visibility="{x:Bind ViewModel.SelectedAlert, Mode=OneWay, Converter={StaticResource NullToVisibilityConverter}}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Global Sidebar Header -->
                <Grid Grid.Row="0" Padding="16" BorderBrush="{StaticResource BorderLightBrush}" BorderThickness="0,0,0,1"
                      Visibility="{x:Bind ViewModel.SelectedAlert, Mode=OneWay, Converter={StaticResource NullToVisibilityConverter}}">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- Tabs -->
                    <Border Grid.Column="0" Background="Transparent" CornerRadius="8" Padding="4" HorizontalAlignment="Center">
                        <StackPanel Orientation="Horizontal" Spacing="4">
                            <!-- Info Tab -->
                            <Button Command="{x:Bind ViewModel.ShowSummaryCommand}"
                                    BorderThickness="{x:Bind ViewModel.IsSidebarSummaryVisible, Mode=OneWay, Converter={StaticResource BoolToThicknessConverter}}"
                                    BorderBrush="{x:Bind ViewModel.IsSidebarSummaryVisible, Mode=OneWay, Converter={StaticResource BoolToAccentColorConverter}}"
                                    Padding="12,6" Background="Transparent" CornerRadius="6">
                                <StackPanel Orientation="Horizontal" Spacing="6">
                                    <FontIcon Glyph="&#xE946;" FontSize="14"
                                              Foreground="{x:Bind ViewModel.IsSidebarSummaryVisible, Mode=OneWay, Converter={StaticResource BoolToAccentColorConverter}}"/>
                                    <TextBlock Text="ThÃ´ng tin" FontSize="13" FontWeight="SemiBold"
                                               Foreground="{x:Bind ViewModel.IsSidebarSummaryVisible, Mode=OneWay, Converter={StaticResource BoolToAccentColorConverter}}"/>
                                </StackPanel>
                            </Button>

                            <!-- History Tab -->
                            <Button Command="{x:Bind ViewModel.ShowHistoryCommand}"
                                    BorderThickness="{x:Bind ViewModel.IsSidebarHistoryVisible, Mode=OneWay, Converter={StaticResource BoolToThicknessConverter}}"
                                    BorderBrush="{x:Bind ViewModel.IsSidebarHistoryVisible, Mode=OneWay, Converter={StaticResource BoolToAccentColorConverter}}"
                                    Padding="12,6" Background="Transparent" CornerRadius="6">
                                <StackPanel Orientation="Horizontal" Spacing="6">
                                    <FontIcon Glyph="&#xE81C;" FontSize="14"
                                              Foreground="{x:Bind ViewModel.IsSidebarHistoryVisible, Mode=OneWay, Converter={StaticResource BoolToAccentColorConverter}}"/>
                                    <TextBlock Text="Lá»‹ch sá»­" FontSize="13" FontWeight="SemiBold"
                                               Foreground="{x:Bind ViewModel.IsSidebarHistoryVisible, Mode=OneWay, Converter={StaticResource BoolToAccentColorConverter}}"/>
                                </StackPanel>
                            </Button>

                            <!-- Process Tab -->
                            <Button Command="{x:Bind ViewModel.ShowProcessingCommand}"
                                    BorderThickness="{x:Bind ViewModel.IsSidebarProcessingVisible, Mode=OneWay, Converter={StaticResource BoolToThicknessConverter}}"
                                    BorderBrush="{x:Bind ViewModel.IsSidebarProcessingVisible, Mode=OneWay, Converter={StaticResource BoolToAccentColorConverter}}"
                                    Padding="12,6" Background="Transparent" CornerRadius="6">
                                <StackPanel Orientation="Horizontal" Spacing="6">
                                    <FontIcon Glyph="&#xE768;" FontSize="14"
                                              Foreground="{x:Bind ViewModel.IsSidebarProcessingVisible, Mode=OneWay, Converter={StaticResource BoolToAccentColorConverter}}"/>
                                    <TextBlock Text="Xá»­ lÃ½" FontSize="13" FontWeight="SemiBold"
                                               Foreground="{x:Bind ViewModel.IsSidebarProcessingVisible, Mode=OneWay, Converter={StaticResource BoolToAccentColorConverter}}"/>
                                </StackPanel>
                            </Button>
                        </StackPanel>
                    </Border>

                    <!-- Close Button -->
                    <Button Grid.Column="1" Style="{StaticResource IconButtonStyle}"
                            Command="{x:Bind ViewModel.CloseSidebarCommand}" ToolTipService.ToolTip="ÄÃ³ng">
                        <FontIcon Glyph="&#xE711;" FontSize="12"/>
                    </Button>
                </Grid>

                <!-- Summary Content -->
                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto"
                              Visibility="{x:Bind ViewModel.IsSidebarSummaryVisible, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
                    <StackPanel Padding="20" Spacing="16"
                                Visibility="{x:Bind ViewModel.SelectedAlert, Mode=OneWay, Converter={StaticResource NullToVisibilityConverter}}">

                        <!-- Alert Header -->
                        <StackPanel Spacing="8">
                            <TextBlock Text="{x:Bind ViewModel.SelectedAlert.Title, Mode=OneWay}"
                                       FontSize="16" FontWeight="Bold"
                                       Foreground="{StaticResource TextPrimaryBrush}" TextWrapping="Wrap"/>

                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <Border Background="{x:Bind ViewModel.SelectedAlert.SeverityBgColor, Mode=OneWay}"
                                        CornerRadius="4" Padding="8,4">
                                    <TextBlock Text="{x:Bind ViewModel.SelectedAlert.SeverityText, Mode=OneWay}"
                                               FontSize="11" FontWeight="Bold"
                                               Foreground="{x:Bind ViewModel.SelectedAlert.SeverityTextColor, Mode=OneWay}"/>
                                </Border>
                                <Border Background="{x:Bind ViewModel.SelectedAlert.StateBgColor, Mode=OneWay}"
                                        CornerRadius="4" Padding="8,4">
                                    <TextBlock Text="{x:Bind ViewModel.SelectedAlert.StateText, Mode=OneWay}"
                                               FontSize="11" FontWeight="Bold"
                                               Foreground="{x:Bind ViewModel.SelectedAlert.StateColor, Mode=OneWay}"/>
                                </Border>
                            </StackPanel>
                        </StackPanel>

                        <!-- Description -->
                        <Border Background="{StaticResource BackgroundSecondaryBrush}"
                                CornerRadius="8" Padding="12">
                            <TextBlock Text="{x:Bind ViewModel.SelectedAlert.Description, Mode=OneWay}"
                                       FontSize="13" Foreground="{StaticResource TextSecondaryBrush}"
                                       TextWrapping="Wrap"/>
                        </Border>

                        <!-- Location Info -->
                        <StackPanel Spacing="8">
                            <TextBlock Text="ðŸ“ Vá»‹ trÃ­" FontSize="13" FontWeight="SemiBold"
                                       Foreground="{StaticResource TextPrimaryBrush}"/>
                            <Border Background="{StaticResource BackgroundSecondaryBrush}"
                                    CornerRadius="8" Padding="12">
                                <StackPanel Spacing="6">
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <TextBlock Text="Tuyáº¿n:" FontSize="12" Foreground="{StaticResource TextTertiaryBrush}" Width="60"/>
                                        <TextBlock Text="{x:Bind ViewModel.SelectedAlert.LineName, Mode=OneWay}"
                                                   FontSize="12" Foreground="{StaticResource TextPrimaryBrush}" FontWeight="SemiBold"/>
                                    </StackPanel>
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <TextBlock Text="NÃºt:" FontSize="12" Foreground="{StaticResource TextTertiaryBrush}" Width="60"/>
                                        <TextBlock Text="{x:Bind ViewModel.SelectedAlert.NodeName, Mode=OneWay}"
                                                   FontSize="12" Foreground="{StaticResource TextPrimaryBrush}" FontWeight="SemiBold"/>
                                    </StackPanel>
                                </StackPanel>
                            </Border>
                        </StackPanel>

                        <!-- Sensor Info (if exists) -->
                        <StackPanel Spacing="8" x:Name="SensorInfoPanel">
                            <TextBlock Text="ðŸ“Š Dá»¯ liá»‡u cáº£m biáº¿n" FontSize="13" FontWeight="SemiBold"
                                       Foreground="{StaticResource TextPrimaryBrush}"/>
                            <Border Background="{StaticResource BackgroundSecondaryBrush}"
                                    CornerRadius="8" Padding="12">
                                <StackPanel Spacing="6">
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <TextBlock Text="Loáº¡i:" FontSize="12" Foreground="{StaticResource TextTertiaryBrush}" Width="60"/>
                                        <TextBlock Text="{x:Bind ViewModel.SelectedAlert.SensorType, Mode=OneWay}"
                                                   FontSize="12" Foreground="{StaticResource TextPrimaryBrush}"/>
                                    </StackPanel>
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <TextBlock Text="GiÃ¡ trá»‹:" FontSize="12" Foreground="{StaticResource TextTertiaryBrush}" Width="60"/>
                                        <TextBlock FontSize="12" Foreground="{x:Bind ViewModel.SelectedAlert.SeverityColor, Mode=OneWay}"
                                                   FontWeight="Bold">
                                            <Run Text="{x:Bind ViewModel.SelectedAlert.SensorValue, Mode=OneWay}"/>
                                            <Run Text=" "/>
                                            <Run Text="{x:Bind ViewModel.SelectedAlert.SensorUnit, Mode=OneWay}"/>
                                        </TextBlock>
                                    </StackPanel>
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <TextBlock Text="NgÆ°á»¡ng:" FontSize="12" Foreground="{StaticResource TextTertiaryBrush}" Width="60"/>
                                        <TextBlock FontSize="12" Foreground="{StaticResource TextSecondaryBrush}">
                                            <Run Text="{x:Bind ViewModel.SelectedAlert.Threshold, Mode=OneWay}"/>
                                            <Run Text=" "/>
                                            <Run Text="{x:Bind ViewModel.SelectedAlert.SensorUnit, Mode=OneWay}"/>
                                        </TextBlock>
                                    </StackPanel>
                                </StackPanel>
                            </Border>
                        </StackPanel>

                        <!-- Camera & Map Buttons -->
                        <StackPanel Spacing="8">
                            <Button Style="{StaticResource AccentButtonStyle}"
                                    HorizontalAlignment="Stretch"
                                    Visibility="{x:Bind ViewModel.SelectedAlert.HasCamera, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"
                                    Click="ViewCameraButton_Click">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <FontIcon Glyph="&#xE714;" FontSize="14"/>
                                    <TextBlock Text="Xem Camera"/>
                                </StackPanel>
                            </Button>

                            <Button Style="{StaticResource SecondaryButtonStyle}"
                                    HorizontalAlignment="Stretch"
                                    Click="ViewOnMapButton_Click">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <FontIcon Glyph="&#xE81D;" FontSize="14"/>
                                    <TextBlock Text="Xem trÃªn báº£n Ä‘á»“"/>
                                </StackPanel>
                            </Button>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>

                <!-- History Content -->
                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto"
                              Visibility="{x:Bind ViewModel.IsSidebarHistoryVisible, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
                    <StackPanel Padding="20" Spacing="16"
                                Visibility="{x:Bind ViewModel.SelectedAlert, Mode=OneWay, Converter={StaticResource NullToVisibilityConverter}}">

                        <!-- Timeline -->
                        <StackPanel Spacing="8">
                            <TextBlock Text="â±ï¸ DÃ²ng sá»± kiá»‡n" FontSize="13" FontWeight="SemiBold"
                                       Foreground="{StaticResource TextPrimaryBrush}"/>
                            <Border Background="{StaticResource BackgroundSecondaryBrush}"
                                    CornerRadius="8" Padding="12">
                                <StackPanel Spacing="16">
                                    <!-- Created -->
                                    <Grid>
                                        <Grid.ColumnDefinitions><ColumnDefinition Width="24"/><ColumnDefinition Width="*"/></Grid.ColumnDefinitions>
                                        <Border Grid.Column="0" Background="#FEE2E2" CornerRadius="10" Width="20" Height="20" VerticalAlignment="Top">
                                            <FontIcon Glyph="&#xE7BA;" FontSize="10" Foreground="#DC2626" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                        </Border>
                                        <StackPanel Grid.Column="1" Margin="8,0,0,0">
                                            <TextBlock Text="PhÃ¡t sinh cáº£nh bÃ¡o" FontSize="12" FontWeight="SemiBold" Foreground="{StaticResource TextPrimaryBrush}"/>
                                            <TextBlock Text="{x:Bind ViewModel.SelectedAlert.CreatedAt, Mode=OneWay}"
                                                       FontSize="11" Foreground="{StaticResource TextTertiaryBrush}"/>
                                        </StackPanel>
                                    </Grid>

                                    <!-- Acknowledged -->
                                    <Grid Visibility="{x:Bind ViewModel.SelectedAlert.AcknowledgedAt, Mode=OneWay, Converter={StaticResource NullToVisibilityConverter}}">
                                        <Grid.ColumnDefinitions><ColumnDefinition Width="24"/><ColumnDefinition Width="*"/></Grid.ColumnDefinitions>
                                        <Border Grid.Column="0" Background="#DBEAFE" CornerRadius="10" Width="20" Height="20" VerticalAlignment="Top">
                                            <FontIcon Glyph="&#xE73E;" FontSize="10" Foreground="#2563EB" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                        </Border>
                                        <StackPanel Grid.Column="1" Margin="8,0,0,0">
                                            <TextBlock Text="ÄÃ£ xÃ¡c nháº­n" FontSize="12" FontWeight="SemiBold" Foreground="{StaticResource TextPrimaryBrush}"/>
                                            <TextBlock FontSize="11" Foreground="{StaticResource TextSecondaryBrush}">
                                                <Run Text="bá»Ÿi"/>
                                                <Run Text="{x:Bind ViewModel.SelectedAlert.AcknowledgedBy, Mode=OneWay}"/>
                                            </TextBlock>
                                            <TextBlock Text="{x:Bind ViewModel.SelectedAlert.AcknowledgedAt, Mode=OneWay}"
                                                       FontSize="11" Foreground="{StaticResource TextTertiaryBrush}"/>
                                        </StackPanel>
                                    </Grid>

                                    <!-- Resolved -->
                                    <Grid Visibility="{x:Bind ViewModel.SelectedAlert.ResolvedAt, Mode=OneWay, Converter={StaticResource NullToVisibilityConverter}}">
                                        <Grid.ColumnDefinitions><ColumnDefinition Width="24"/><ColumnDefinition Width="*"/></Grid.ColumnDefinitions>
                                        <Border Grid.Column="0" Background="#DCFCE7" CornerRadius="10" Width="20" Height="20" VerticalAlignment="Top">
                                            <FontIcon Glyph="&#xE930;" FontSize="10" Foreground="#16A34A" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                        </Border>
                                        <StackPanel Grid.Column="1" Margin="8,0,0,0">
                                            <TextBlock Text="ÄÃ£ giáº£i quyáº¿t" FontSize="12" FontWeight="SemiBold" Foreground="{StaticResource TextPrimaryBrush}"/>
                                            <TextBlock FontSize="11" Foreground="{StaticResource TextSecondaryBrush}">
                                                <Run Text="bá»Ÿi"/>
                                                <Run Text="{x:Bind ViewModel.SelectedAlert.ResolvedBy, Mode=OneWay}"/>
                                            </TextBlock>
                                            <TextBlock Text="{x:Bind ViewModel.SelectedAlert.ResolvedAt, Mode=OneWay}"
                                                       FontSize="11" Foreground="{StaticResource TextTertiaryBrush}"/>
                                        </StackPanel>
                                    </Grid>
                                </StackPanel>
                            </Border>
                        </StackPanel>

                        <!-- Notes List -->
                        <StackPanel Spacing="8">
                            <TextBlock Text="ðŸ“ Ghi chÃº" FontSize="13" FontWeight="SemiBold"
                                       Foreground="{StaticResource TextPrimaryBrush}"/>
                            <ItemsRepeater ItemsSource="{x:Bind ViewModel.SelectedAlert.Notes, Mode=OneWay}">
                                <ItemsRepeater.ItemTemplate>
                                    <DataTemplate x:DataType="models:AlertNote">
                                        <Border Background="{StaticResource BackgroundSecondaryBrush}" CornerRadius="8" Padding="12" Margin="0,0,0,8">
                                            <StackPanel Spacing="4">
                                                <Grid>
                                                    <TextBlock Text="{x:Bind Author}" FontSize="11" FontWeight="Bold" Foreground="{StaticResource TextPrimaryBrush}"/>
                                                    <TextBlock Text="{x:Bind CreatedAt}" FontSize="10" HorizontalAlignment="Right" Foreground="{StaticResource TextTertiaryBrush}"/>
                                                </Grid>
                                                <TextBlock Text="{x:Bind Content}" FontSize="12" Foreground="{StaticResource TextSecondaryBrush}" TextWrapping="Wrap"/>
                                            </StackPanel>
                                        </Border>
                                    </DataTemplate>
                                </ItemsRepeater.ItemTemplate>
                            </ItemsRepeater>
                        </StackPanel>

                        <!-- Add Note Section -->
                        <StackPanel Spacing="8">
                            <TextBox x:Name="NoteTextBox" PlaceholderText="Nháº­p ghi chÃº má»›i..."
                                     AcceptsReturn="True" TextWrapping="Wrap" MinHeight="60"
                                     Style="{StaticResource DefaultTextBoxStyle}"/>
                            <Button Style="{StaticResource PrimaryButtonStyle}"
                                    HorizontalAlignment="Right" Click="AddNoteButton_Click">
                                <StackPanel Orientation="Horizontal" Spacing="6">
                                    <FontIcon Glyph="&#xE710;" FontSize="12"/>
                                    <TextBlock Text="ThÃªm ghi chÃº"/>
                                </StackPanel>
                            </Button>
                        </StackPanel>

                    </StackPanel>
                </ScrollViewer>

                <!-- Processing Content -->
                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto"
                              Visibility="{x:Bind ViewModel.IsSidebarProcessingVisible, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
                    <StackPanel Padding="20" Spacing="16"
                                Visibility="{x:Bind ViewModel.SelectedAlert, Mode=OneWay, Converter={StaticResource NullToVisibilityConverter}}">

                        <TextBlock Text="Quy trÃ¬nh xá»­ lÃ½ sá»± cá»‘" FontSize="14" FontWeight="SemiBold" Foreground="{StaticResource TextPrimaryBrush}"/>

                        <Border Background="#FEF9C3" CornerRadius="8" Padding="12" BorderBrush="#FDE047" BorderThickness="1">
                            <StackPanel Spacing="8">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <FontIcon Glyph="&#xE7BA;" FontSize="14" Foreground="#B45309"/>
                                    <TextBlock Text="HÆ°á»›ng dáº«n xá»­ lÃ½" FontWeight="Bold" Foreground="#B45309"/>
                                </StackPanel>
                                <TextBlock Text="1. XÃ¡c nháº­n sá»± cá»‘ vÃ  kiá»ƒm tra camera/hiá»‡n trÆ°á»ng.&#x0a;2. CÃ¡ch ly khu vá»±c náº¿u cáº§n thiáº¿t.&#x0a;3. Cáº­p nháº­t tráº¡ng thÃ¡i vÃ  ghi chÃº quÃ¡ trÃ¬nh xá»­ lÃ½.&#x0a;4. ÄÃ³ng cáº£nh bÃ¡o khi hoÃ n táº¥t."
                                           FontSize="12" Foreground="#854D0E" TextWrapping="Wrap"/>
                            </StackPanel>
                        </Border>

                        <StackPanel Spacing="12">
                            <TextBlock Text="Thao tÃ¡c" FontSize="13" FontWeight="SemiBold" Foreground="{StaticResource TextPrimaryBrush}"/>

                            <!-- Acknowledge Button -->
                            <Button Style="{StaticResource SecondaryButtonStyle}"
                                    HorizontalAlignment="Stretch"
                                    IsEnabled="{x:Bind ViewModel.SelectedAlert.CanAcknowledge, Mode=OneWay}"
                                    Click="AcknowledgeButton_Click">
                                <StackPanel Orientation="Horizontal" Spacing="12">
                                    <FontIcon Glyph="&#xE73E;" FontSize="16"/>
                                    <StackPanel>
                                        <TextBlock Text="XÃ¡c nháº­n" FontWeight="SemiBold"/>
                                        <TextBlock Text="ÄÃ¡nh dáº¥u Ä‘Ã£ tiáº¿p nháº­n sá»± cá»‘" FontSize="11" Foreground="{StaticResource TextTertiaryBrush}"/>
                                    </StackPanel>
                                </StackPanel>
                            </Button>

                            <!-- Process Button -->
                            <Button Style="{StaticResource SecondaryButtonStyle}"
                                    HorizontalAlignment="Stretch"
                                    IsEnabled="{x:Bind ViewModel.SelectedAlert.CanProcess, Mode=OneWay}"
                                    Click="ProcessButton_Click">
                                <StackPanel Orientation="Horizontal" Spacing="12">
                                    <FontIcon Glyph="&#xE768;" FontSize="16"/>
                                    <StackPanel>
                                        <TextBlock Text="Xá»­ lÃ½" FontWeight="SemiBold"/>
                                        <TextBlock Text="Báº¯t Ä‘áº§u quÃ¡ trÃ¬nh xá»­ lÃ½" FontSize="11" Foreground="{StaticResource TextTertiaryBrush}"/>
                                    </StackPanel>
                                </StackPanel>
                            </Button>

                            <!-- Resolve Button -->
                            <Button Style="{StaticResource SuccessButtonStyle}"
                                    HorizontalAlignment="Stretch"
                                    IsEnabled="{x:Bind ViewModel.SelectedAlert.CanResolve, Mode=OneWay}"
                                    Click="ResolveButton_Click">
                                <StackPanel Orientation="Horizontal" Spacing="12">
                                    <FontIcon Glyph="&#xE930;" FontSize="16" Foreground="White" />
                                    <StackPanel>
                                        <TextBlock Text="Giáº£i quyáº¿t" FontWeight="SemiBold"/>
                                        <TextBlock Text="ÄÃ£ kháº¯c phá»¥c xong sá»± cá»‘" FontSize="11" Opacity="0.8"/>
                                    </StackPanel>
                                </StackPanel>
                            </Button>

                            <!-- Close Button -->
                            <Button Style="{StaticResource SecondaryButtonStyle}"
                                    HorizontalAlignment="Stretch"
                                    IsEnabled="{x:Bind ViewModel.SelectedAlert.CanClose, Mode=OneWay}"
                                    Click="CloseAlertButton_Click">
                                <StackPanel Orientation="Horizontal" Spacing="12">
                                    <FontIcon Glyph="&#xE8BB;" FontSize="16"/>
                                    <StackPanel>
                                        <TextBlock Text="ÄÃ³ng" FontWeight="SemiBold"/>
                                        <TextBlock Text="LÆ°u trá»¯ vÃ  Ä‘Ã³ng há»“ sÆ¡" FontSize="11" Foreground="{StaticResource TextTertiaryBrush}"/>
                                    </StackPanel>
                                </StackPanel>
                            </Button>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>

                <!-- Empty State -->
                <StackPanel Grid.Row="1" VerticalAlignment="Center" HorizontalAlignment="Center" Spacing="12"
                            Visibility="{x:Bind ViewModel.SelectedAlert, Mode=OneWay, Converter={StaticResource NullToInverseVisibilityConverter}}">
                    <FontIcon Glyph="&#xE7BA;" FontSize="48" Foreground="{StaticResource TextTertiaryBrush}"/>
                    <TextBlock Text="Chá»n má»™t cáº£nh bÃ¡o Ä‘á»ƒ xem chi tiáº¿t"
                               FontSize="13" Foreground="{StaticResource TextTertiaryBrush}"
                               TextAlignment="Center"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Page>
